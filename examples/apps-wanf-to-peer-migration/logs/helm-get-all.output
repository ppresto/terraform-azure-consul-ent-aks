NAME: consul1-westus2
LAST DEPLOYED: Mon Jan  9 12:22:28 2023
NAMESPACE: consul
STATUS: deployed
REVISION: 2
USER-SUPPLIED VALUES:
connectInject:
  consulNamespaces:
    mirroringK8S: true
  enabled: true
  transparentProxy:
    defaultEnabled: false
controller:
  enabled: true
global:
  acls:
    manageSystemACLs: true
    replicationToken:
      secretKey: replicationToken
      secretName: consul-federation
  datacenter: consul1-westus2
  enableConsulNamespaces: true
  enterpriseLicense:
    enableLicenseAutoload: true
    secretKey: key
    secretName: consul-ent-license
  federation:
    enabled: true
    k8sAuthMethodHost: https://aks-6b7343b5.hcp.westus2.azmk8s.io:443
    primaryDatacenter: consul0-eastus
  gossipEncryption:
    secretKey: gossipEncryptionKey
    secretName: consul-federation
  image: hashicorp/consul-enterprise:1.14.3-ent
  imageConsulDataplane: hashicorp/consul-dataplane:1.0.0
  imageK8S: docker.mirror.hashicorp.services/hashicorp/consul-k8s-control-plane:1.0.2
  name: consul
  peering:
    enabled: true
  tls:
    caCert:
      secretKey: caCert
      secretName: consul-federation
    caKey:
      secretKey: caKey
      secretName: consul-federation
    enabled: true
ingressGateways:
  defaults:
    replicas: 1
  enabled: true
  gateways:
  - name: ingress-gateway
    service:
      type: LoadBalancer
meshGateway:
  enabled: true
  replicas: 3
  service:
    annotations: |
      service.beta.kubernetes.io/azure-load-balancer-internal: "true"
    enabled: true
    type: LoadBalancer
server:
  extraConfig: |
    {
      "log_level": "TRACE"
    }
  extraVolumes:
  - items:
    - key: serverConfigJSON
      path: config.json
    load: true
    name: consul-federation
    type: secret
  replicas: 3
ui:
  service:
    enabled: true
    type: LoadBalancer

COMPUTED VALUES:
apiGateway:
  controller:
    annotations: null
    nodeSelector: null
    priorityClassName: ""
    replicas: 1
    service:
      annotations: null
    tolerations: null
  enabled: false
  image: null
  imageEnvoy: envoyproxy/envoy:v1.23.1
  initCopyConsulContainer:
    resources:
      limits:
        cpu: 50m
        memory: 150Mi
      requests:
        cpu: 50m
        memory: 25Mi
  logLevel: info
  managedGatewayClass:
    copyAnnotations:
      service: null
    deployment: null
    enabled: true
    nodeSelector: null
    serviceType: LoadBalancer
    tolerations: null
    useHostPorts: false
  resources:
    limits:
      cpu: 100m
      memory: 100Mi
    requests:
      cpu: 100m
      memory: 100Mi
  serviceAccount:
    annotations: null
client:
  affinity: null
  annotations: null
  containerSecurityContext:
    aclInit: null
    client: null
    tlsInit: null
  dataDirectoryHostPath: null
  dnsPolicy: null
  enabled: false
  exposeGossipPorts: false
  extraConfig: |
    {}
  extraContainers: []
  extraEnvironmentVars: {}
  extraLabels: null
  extraVolumes: []
  grpc: true
  hostNetwork: false
  image: null
  join: null
  nodeMeta:
    host-ip: ${HOST_IP}
    pod-name: ${HOSTNAME}
  nodeSelector: null
  priorityClassName: ""
  resources:
    limits:
      cpu: 100m
      memory: 100Mi
    requests:
      cpu: 100m
      memory: 100Mi
  securityContext:
    fsGroup: 1000
    runAsGroup: 1000
    runAsNonRoot: true
    runAsUser: 100
  serviceAccount:
    annotations: null
  tolerations: ""
  updateStrategy: null
connectInject:
  aclBindingRuleSelector: serviceaccount.name!=default
  aclInjectToken:
    secretKey: null
    secretName: null
  affinity: null
  annotations: null
  cni:
    cniBinDir: /opt/cni/bin
    cniNetDir: /etc/cni/net.d
    enabled: false
    logLevel: null
    multus: false
    namespace: null
    resourceQuota:
      pods: 5000
    resources:
      limits:
        cpu: 100m
        memory: 100Mi
      requests:
        cpu: 75m
        memory: 75Mi
    securityContext:
      runAsGroup: 0
      runAsNonRoot: false
      runAsUser: 0
    updateStrategy: null
  consulNamespaces:
    consulDestinationNamespace: default
    mirroringK8S: true
    mirroringK8SPrefix: ""
  consulNode:
    meta: null
  default: false
  disruptionBudget:
    enabled: true
    maxUnavailable: null
    minAvailable: null
  enabled: true
  envoyExtraArgs: null
  extraLabels: null
  failurePolicy: Fail
  image: null
  imageConsul: null
  initContainer:
    resources:
      limits:
        cpu: 50m
        memory: 150Mi
      requests:
        cpu: 50m
        memory: 25Mi
  k8sAllowNamespaces:
  - '*'
  k8sDenyNamespaces: []
  logLevel: ""
  metrics:
    defaultEnableMerging: false
    defaultEnabled: '-'
    defaultMergedMetricsPort: 20100
    defaultPrometheusScrapePath: /metrics
    defaultPrometheusScrapePort: 20200
  namespaceSelector: |
    matchExpressions:
      - key: "kubernetes.io/metadata.name"
        operator: "NotIn"
        values: ["kube-system","local-path-storage"]
  nodeSelector: null
  overrideAuthMethodName: ""
  priorityClassName: ""
  replicas: 1
  resources:
    limits:
      cpu: 50m
      memory: 50Mi
    requests:
      cpu: 50m
      memory: 50Mi
  serviceAccount:
    annotations: null
  sidecarProxy:
    concurrency: 2
    resources:
      limits:
        cpu: null
        memory: null
      requests:
        cpu: null
        memory: null
  tolerations: null
  transparentProxy:
    defaultEnabled: false
    defaultOverwriteProbes: true
controller:
  enabled: true
dns:
  additionalSpec: null
  annotations: null
  clusterIP: null
  enableRedirection: '-'
  enabled: '-'
  type: ClusterIP
externalServers:
  enabled: false
  grpcPort: 8502
  hosts: []
  httpsPort: 8501
  k8sAuthMethodHost: null
  skipServerWatch: false
  tlsServerName: null
  useSystemRoots: false
global:
  acls:
    bootstrapToken:
      secretKey: null
      secretName: null
    createReplicationToken: false
    manageSystemACLs: true
    nodeSelector: null
    partitionToken:
      secretKey: null
      secretName: null
    replicationToken:
      secretKey: replicationToken
      secretName: consul-federation
    tolerations: ""
  adminPartitions:
    enabled: false
    name: default
  cloud:
    apiHost:
      secretKey: null
      secretName: null
    authUrl:
      secretKey: null
      secretName: null
    clientId:
      secretKey: null
      secretName: null
    clientSecret:
      secretKey: null
      secretName: null
    enabled: false
    resourceId:
      secretKey: null
      secretName: null
    scadaAddress:
      secretKey: null
      secretName: null
  consulAPITimeout: 5s
  datacenter: consul1-westus2
  domain: consul
  enableConsulNamespaces: true
  enablePodSecurityPolicies: false
  enabled: true
  enterpriseLicense:
    enableLicenseAutoload: true
    secretKey: key
    secretName: consul-ent-license
  federation:
    createFederationSecret: false
    enabled: true
    k8sAuthMethodHost: https://aks-6b7343b5.hcp.westus2.azmk8s.io:443
    primaryDatacenter: consul0-eastus
    primaryGateways: []
  gossipEncryption:
    autoGenerate: false
    secretKey: gossipEncryptionKey
    secretName: consul-federation
  image: hashicorp/consul-enterprise:1.14.3-ent
  imageConsulDataplane: hashicorp/consul-dataplane:1.0.0
  imageK8S: docker.mirror.hashicorp.services/hashicorp/consul-k8s-control-plane:1.0.2
  imagePullSecrets: []
  logJSON: false
  logLevel: info
  metrics:
    agentMetricsRetentionTime: 1m
    enableAgentMetrics: false
    enableGatewayMetrics: true
    enabled: false
  name: consul
  openshift:
    enabled: false
  peering:
    enabled: true
  recursors: []
  secretsBackend:
    vault:
      adminPartitionsRole: ""
      agentAnnotations: null
      ca:
        secretKey: ""
        secretName: ""
      connectCA:
        additionalConfig: |
          {}
        address: ""
        authMethodPath: kubernetes
        intermediatePKIPath: ""
        rootPKIPath: ""
      connectInject:
        caCert:
          secretName: null
        tlsCert:
          secretName: null
      connectInjectRole: ""
      consulCARole: ""
      consulClientRole: ""
      consulServerRole: ""
      controller:
        caCert:
          secretName: null
        tlsCert:
          secretName: null
      controllerRole: ""
      enabled: false
      manageSystemACLsRole: ""
  tls:
    caCert:
      secretKey: caCert
      secretName: consul-federation
    caKey:
      secretKey: caKey
      secretName: consul-federation
    enableAutoEncrypt: false
    enabled: true
    httpsOnly: true
    serverAdditionalDNSSANs: []
    serverAdditionalIPSANs: []
    verify: true
ingressGateways:
  defaults:
    affinity: null
    annotations: null
    consulNamespace: default
    nodeSelector: null
    priorityClassName: ""
    replicas: 1
    resources:
      limits:
        cpu: 100m
        memory: 100Mi
      requests:
        cpu: 100m
        memory: 100Mi
    service:
      additionalSpec: null
      annotations: null
      ports:
      - nodePort: null
        port: 8080
      - nodePort: null
        port: 8443
      type: ClusterIP
    serviceAccount:
      annotations: null
    terminationGracePeriodSeconds: 10
    tolerations: null
    topologySpreadConstraints: ""
  enabled: true
  gateways:
  - name: ingress-gateway
    service:
      type: LoadBalancer
meshGateway:
  affinity: null
  annotations: null
  consulServiceName: mesh-gateway
  containerPort: 8443
  dnsPolicy: null
  enabled: true
  hostNetwork: false
  hostPort: null
  initServiceInitContainer:
    resources:
      limits:
        cpu: 50m
        memory: 50Mi
      requests:
        cpu: 50m
        memory: 50Mi
  nodeSelector: null
  priorityClassName: ""
  replicas: 3
  resources:
    limits:
      cpu: 100m
      memory: 100Mi
    requests:
      cpu: 100m
      memory: 100Mi
  service:
    additionalSpec: null
    annotations: |
      service.beta.kubernetes.io/azure-load-balancer-internal: "true"
    enabled: true
    nodePort: null
    port: 443
    type: LoadBalancer
  serviceAccount:
    annotations: null
  tolerations: null
  topologySpreadConstraints: ""
  wanAddress:
    port: 443
    source: Service
    static: ""
prometheus:
  enabled: false
server:
  affinity: |
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchLabels:
              app: {{ template "consul.name" . }}
              release: "{{ .Release.Name }}"
              component: server
          topologyKey: kubernetes.io/hostname
  annotations: null
  bootstrapExpect: null
  connect: true
  containerSecurityContext:
    server: null
  disruptionBudget:
    enabled: true
    maxUnavailable: null
  enabled: '-'
  exposeGossipAndRPCPorts: false
  exposeService:
    annotations: null
    enabled: '-'
    nodePort:
      grpc: null
      http: null
      https: null
      rpc: null
      serf: null
    type: LoadBalancer
  extraConfig: |
    {
      "log_level": "TRACE"
    }
  extraContainers: []
  extraEnvironmentVars: {}
  extraLabels: null
  extraVolumes:
  - items:
    - key: serverConfigJSON
      path: config.json
    load: true
    name: consul-federation
    type: secret
  image: null
  nodeSelector: null
  ports:
    serflan:
      port: 8301
  priorityClassName: ""
  replicas: 3
  resources:
    limits:
      cpu: 100m
      memory: 100Mi
    requests:
      cpu: 100m
      memory: 100Mi
  securityContext:
    fsGroup: 1000
    runAsGroup: 1000
    runAsNonRoot: true
    runAsUser: 100
  serverCert:
    secretName: null
  service:
    annotations: null
  serviceAccount:
    annotations: null
  snapshotAgent:
    caCert: null
    configSecret:
      secretKey: null
      secretName: null
    enabled: false
    interval: 1h
    resources:
      limits:
        cpu: 50m
        memory: 50Mi
      requests:
        cpu: 50m
        memory: 50Mi
  storage: 10Gi
  storageClass: null
  tolerations: ""
  topologySpreadConstraints: ""
  updatePartition: 0
syncCatalog:
  aclSyncToken:
    secretKey: null
    secretName: null
  addK8SNamespaceSuffix: true
  affinity: null
  annotations: null
  consulNamespaces:
    consulDestinationNamespace: default
    mirroringK8S: true
    mirroringK8SPrefix: ""
  consulNodeName: k8s-sync
  consulPrefix: null
  consulWriteInterval: null
  default: true
  enabled: false
  extraLabels: null
  image: null
  k8sAllowNamespaces:
  - '*'
  k8sDenyNamespaces:
  - kube-system
  - kube-public
  k8sPrefix: null
  k8sSourceNamespace: null
  k8sTag: null
  logLevel: ""
  nodePortSyncType: ExternalFirst
  nodeSelector: null
  priorityClassName: ""
  resources:
    limits:
      cpu: 50m
      memory: 50Mi
    requests:
      cpu: 50m
      memory: 50Mi
  serviceAccount:
    annotations: null
  syncClusterIPServices: true
  toConsul: true
  toK8S: true
  tolerations: null
terminatingGateways:
  defaults:
    affinity: null
    annotations: null
    consulNamespace: default
    extraVolumes: []
    nodeSelector: null
    priorityClassName: ""
    replicas: 1
    resources:
      limits:
        cpu: 100m
        memory: 100Mi
      requests:
        cpu: 100m
        memory: 100Mi
    serviceAccount:
      annotations: null
    tolerations: null
    topologySpreadConstraints: ""
  enabled: false
  gateways:
  - name: terminating-gateway
tests:
  enabled: true
ui:
  dashboardURLTemplates:
    service: ""
  enabled: '-'
  ingress:
    annotations: null
    enabled: false
    hosts: []
    ingressClassName: ""
    pathType: Prefix
    tls: []
  metrics:
    baseURL: http://prometheus-server
    enabled: '-'
    provider: prometheus
  service:
    additionalSpec: null
    annotations: null
    enabled: true
    nodePort:
      http: null
      https: null
    port:
      http: 80
      https: 443
    type: LoadBalancer
webhookCertManager:
  nodeSelector: null
  tolerations: null

HOOKS:
---
# Source: consul/templates/tls-init-cleanup-serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: consul-tls-init-cleanup
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: tls-init-cleanup
  annotations:
    "helm.sh/hook": pre-delete
    "helm.sh/hook-delete-policy": hook-succeeded
---
# Source: consul/templates/tls-init-serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: consul-tls-init
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: tls-init
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation
---
# Source: consul/templates/tls-init-cleanup-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: consul-tls-init-cleanup
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: tls-init-cleanup
  annotations:
    "helm.sh/hook": pre-delete
    "helm.sh/hook-delete-policy": hook-succeeded
rules:
- apiGroups: [""]
  resources:
    - secrets
  resourceNames:
    - consul-server-cert
  verbs:
    - delete
---
# Source: consul/templates/tls-init-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: consul-tls-init
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: tls-init
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation
rules:
- apiGroups: [""]
  resources:
    - secrets
  verbs:
    - create
    - update
    - get
    - list
---
# Source: consul/templates/tls-init-cleanup-rolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: consul-tls-init-cleanup
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: tls-init-cleanup
  annotations:
    "helm.sh/hook": pre-delete
    "helm.sh/hook-delete-policy": hook-succeeded
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: consul-tls-init-cleanup
subjects:
- kind: ServiceAccount
  name: consul-tls-init-cleanup
---
# Source: consul/templates/tls-init-rolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: consul-tls-init
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: tls-init
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: consul-tls-init
subjects:
- kind: ServiceAccount
  name: consul-tls-init
---
# Source: consul/templates/tests/test-runner.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "consul-test"
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
  annotations:
    "helm.sh/hook": test-success
spec:
  volumes:
    - name: consul-ca-cert
      secret:
        secretName: consul-federation
        items:
        - key: caCert
          path: tls.crt
    - name: consul-auto-encrypt-ca-cert
      emptyDir:
        medium: "Memory"
  containers:
    - name: consul-test
      image: "hashicorp/consul-enterprise:1.14.3-ent"
      env:
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        - name: CONSUL_HTTP_ADDR
          value: https://$(HOST_IP):8501
        - name: CONSUL_CACERT
          value: /consul/tls/ca/tls.crt
      volumeMounts:
      - name: consul-ca-cert
        mountPath: /consul/tls/ca
        readOnly: true
      command:
        - "/bin/sh"
        - "-ec"
        - |
            consul members | tee members.txt
            if [ $(grep -c consul-server members.txt) != $(grep consul-server members.txt | grep -c alive) ]
            then
              echo "Failed because not all consul servers are available"
              exit 1
            fi

  restartPolicy: Never
---
# Source: consul/templates/server-acl-init-cleanup-job.yaml
# This job deletes the server-acl-init job once it completes successfully.
# It runs as a helm hook because it only needs to run when the server-acl-init
# Job gets recreated which only happens during an install or upgrade.
# We also utilize the helm hook-delete-policy to delete this job itself.
# We want to delete the server-acl-init job because once it runs successfully
# it's not needed and also because if it stays around then when users run
# helm upgrade with values that change the spec of the job, Kubernetes errors
# because the job spec is immutable. If the job is deleted, then a new job
# is created and there's no error.
apiVersion: batch/v1
kind: Job
metadata:
  name: consul-server-acl-init-cleanup
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: server-acl-init-cleanup
  annotations:
    "helm.sh/hook": post-install,post-upgrade
    "helm.sh/hook-weight": "0"
    # If the hook fails then all that happens is we didn't delete the job.
    # There's no reason for *this* job to stay around in that case so delete
    # regardless of success.
    "helm.sh/hook-delete-policy": hook-succeeded,hook-failed
spec:
  template:
    metadata:
      name: consul-server-acl-init-cleanup
      labels:
        app: consul
        chart: consul-helm
        release: consul1-westus2
        component: server-acl-init-cleanup
      annotations:
        "consul.hashicorp.com/connect-inject": "false"
    spec:
      restartPolicy: Never
      serviceAccountName: consul-server-acl-init-cleanup
      containers:
        - name: server-acl-init-cleanup
          image: docker.mirror.hashicorp.services/hashicorp/consul-k8s-control-plane:1.0.2
          command:
            - consul-k8s-control-plane
          args:
            - delete-completed-job
            - -log-level=info
            - -log-json=false
            - -k8s-namespace=consul
            - consul-server-acl-init
          resources:
            requests:
              memory: "50Mi"
              cpu: "50m"
            limits:
              memory: "50Mi"
              cpu: "50m"
---
# Source: consul/templates/tls-init-cleanup-job.yaml
# tls-init-cleanup job deletes Kubernetes secrets created by tls-init
apiVersion: batch/v1
kind: Job
metadata:
  name: consul-tls-init-cleanup
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: tls-init-cleanup
  annotations:
    "helm.sh/hook": pre-delete
    "helm.sh/hook-delete-policy": hook-succeeded
    "helm.sh/hook-weight": "1"
spec:
  template:
    metadata:
      name: consul-tls-init-cleanup
      labels:
        app: consul
        chart: consul-helm
        release: consul1-westus2
        component: tls-init-cleanup
      annotations:
        "consul.hashicorp.com/connect-inject": "false"
    spec:
      restartPolicy: Never
      serviceAccountName: consul-tls-init-cleanup
      containers:
        - name: tls-init-cleanup
          image: "hashicorp/consul-enterprise:1.14.3-ent"
          env:
            - name: NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
          command:
            - "/bin/sh"
            - "-ec"
            - |
              curl -s -X DELETE --cacert /var/run/secrets/kubernetes.io/serviceaccount/ca.crt \
                https://${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT}/api/v1/namespaces/${NAMESPACE}/secrets/consul-server-cert \
                -H "Authorization: Bearer $( cat /var/run/secrets/kubernetes.io/serviceaccount/token )"
          resources:
            requests:
              memory: "50Mi"
              cpu: "50m"
            limits:
              memory: "50Mi"
              cpu: "50m"
---
# Source: consul/templates/tls-init-job.yaml
# tls-init job generate Consul cluster CA and certificates for the Consul servers
# and creates Kubernetes secrets for them.
apiVersion: batch/v1
kind: Job
metadata:
  name: consul-tls-init
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: tls-init
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-weight": "1"
    "helm.sh/hook-delete-policy":  hook-succeeded,before-hook-creation
spec:
  template:
    metadata:
      name: consul-tls-init
      labels:
        app: consul
        chart: consul-helm
        release: consul1-westus2
        component: tls-init
      annotations:
        "consul.hashicorp.com/connect-inject": "false"
    spec:
      restartPolicy: Never
      serviceAccountName: consul-tls-init
      volumes:
      - name: consul-ca-cert
        secret:
          secretName: consul-federation
          items:
          - key: caCert
            path: tls.crt
      - name: consul-ca-key
        secret:
          secretName: consul-federation
          items:
          - key: caKey
            path: tls.key
      containers:
        - name: tls-init
          image: "docker.mirror.hashicorp.services/hashicorp/consul-k8s-control-plane:1.0.2"
          env:
            - name: NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
          workingDir: /tmp
          command:
            - "/bin/sh"
            - "-ec"
            - |
              # Suppress globbing so we can interpolate the $NAMESPACE environment variable
              # and use * at the start of the dns name when setting -additional-dnsname.
              set -o noglob
              consul-k8s-control-plane tls-init \
                -log-level=info \
                -log-json=false \
                -domain=consul \
                -days=730 \
                -name-prefix=consul \
                -k8s-namespace=${NAMESPACE} \
                -ca=/consul/tls/ca/cert/tls.crt \
                -key=/consul/tls/ca/key/tls.key \
                -additional-dnsname="consul-server" \
                -additional-dnsname="*.consul-server" \
                -additional-dnsname="*.consul-server.${NAMESPACE}" \
                -additional-dnsname="consul-server.${NAMESPACE}" \
                -additional-dnsname="*.consul-server.${NAMESPACE}.svc" \
                -additional-dnsname="consul-server.${NAMESPACE}.svc" \
                -additional-dnsname="*.server.consul1-westus2.consul" \
                -dc=consul1-westus2
          volumeMounts:
            - name: consul-ca-cert
              mountPath: /consul/tls/ca/cert
              readOnly: true
            - name: consul-ca-key
              mountPath: /consul/tls/ca/key
              readOnly: true
          resources:
            requests:
              memory: "50Mi"
              cpu: "50m"
            limits:
              memory: "50Mi"
              cpu: "50m"
MANIFEST:
---
# Source: consul/templates/connect-injector-disruptionbudget.yaml
# PodDisruptionBudget to prevent degrading the connectInject cluster through
# voluntary cluster changes.
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: consul-connect-injector
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: connect-injector
spec:
  maxUnavailable: 0
  selector:
    matchLabels:
      app: consul
      release: "consul1-westus2"
      component: connect-injector
---
# Source: consul/templates/server-disruptionbudget.yaml
# PodDisruptionBudget to prevent degrading the server cluster through
# voluntary cluster changes.
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: consul-server
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: server
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app: consul
      release: "consul1-westus2"
      component: server
---
# Source: consul/templates/auth-method-serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: consul-auth-method
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: auth-method
---
# Source: consul/templates/connect-inject-serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: consul-connect-injector
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: connect-injector
---
# Source: consul/templates/ingress-gateways-serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: consul-ingress-gateway
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: ingress-gateway
    ingress-gateway-name: consul-ingress-gateway
---
# Source: consul/templates/mesh-gateway-serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: consul-mesh-gateway
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: mesh-gateway
---
# Source: consul/templates/server-acl-init-cleanup-serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: consul-server-acl-init-cleanup
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: server-acl-init-cleanup
---
# Source: consul/templates/server-acl-init-serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: consul-server-acl-init
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: server-acl-init
---
# Source: consul/templates/server-serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: consul-server
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: server
---
# Source: consul/templates/webhook-cert-manager-serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: consul-webhook-cert-manager
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: webhook-cert-manager
---
# Source: consul/templates/auth-method-secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: consul-auth-method
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: auth-method
  annotations:
    kubernetes.io/service-account.name: consul-auth-method
type: kubernetes.io/service-account-token
---
# Source: consul/templates/server-config-configmap.yaml
# StatefulSet to run the actual Consul server cluster.
apiVersion: v1
kind: ConfigMap
metadata:
  name: consul-server-config
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: server
data:
  server.json: |
    {
      "bind_addr": "0.0.0.0",
      "bootstrap_expect": 3,
      "client_addr": "0.0.0.0",
      "connect": {
        "enabled": true
      },
      "datacenter": "consul1-westus2",
      "data_dir": "/consul/data",
      "domain": "consul",
      "ports": {
        "grpc": -1,
        "grpc_tls": 8502,
        "serf_lan": 8301
      },
      "recursors": [],
      "retry_join": ["consul-server.consul.svc:8301"],
      "peering": {
        "enabled": true
      },
      "server": true
    }
  extra-from-values.json: |-
    {
      "log_level": "TRACE"
    }
    
  acl-config.json: |-
    {
      "acl": {
        "enabled": true,
        "default_policy": "deny",
        "down_policy": "extend-cache",
        "enable_token_replication": true,
        "enable_token_persistence": true
      }
    }
  tls-config.json: |-
    {
      "tls": {
        "internal_rpc": {
          "verify_incoming": true,
          "verify_server_hostname": true
        },
        "grpc": {
          "verify_incoming": false
        },
        "defaults": {
          "verify_outgoing": true,
          "ca_file": "/consul/tls/ca/tls.crt",
          "cert_file": "/consul/tls/server/tls.crt",
          "key_file": "/consul/tls/server/tls.key"
        }
      },
      "ports": {
        "http": -1,
        "https": 8501
      }
    }
  ui-config.json: |-
    {
      "ui_config": {
        "enabled": true
      }
    }
  central-config.json: |-
    {
      "enable_central_service_config": true
    }
  federation-config.json: |-
    {
      "primary_datacenter": "consul0-eastus",
      "primary_gateways": [],
      "connect": {
        "enable_mesh_gateway_wan_federation": true
      }
    }
---
# Source: consul/templates/webhook-cert-manager-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: consul-webhook-cert-manager-config
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: webhook-cert-manager
data:
  webhook-config.json: |-
    [
      {
        "name": "consul-connect-injector",
        "tlsAutoHosts": [
          "consul-connect-injector",
          "consul-connect-injector.consul",
          "consul-connect-injector.consul.svc",
          "consul-connect-injector.consul.svc.cluster.local"
        ],
        "secretName": "consul-connect-inject-webhook-cert",
        "secretNamespace": "consul"
      }
    ]
---
# Source: consul/templates/crd-exportedservices.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.8.0
  creationTimestamp: null
  name: exportedservices.consul.hashicorp.com
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: crd
spec:
  group: consul.hashicorp.com
  names:
    kind: ExportedServices
    listKind: ExportedServicesList
    plural: exportedservices
    shortNames:
    - exported-services
    singular: exportedservices
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The sync status of the resource with Consul
      jsonPath: .status.conditions[?(@.type=="Synced")].status
      name: Synced
      type: string
    - description: The last successful synced time of the resource with Consul
      jsonPath: .status.lastSyncedTime
      name: Last Synced
      type: date
    - description: The age of the resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ExportedServices is the Schema for the exportedservices API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: ExportedServicesSpec defines the desired state of ExportedServices.
            properties:
              services:
                description: Services is a list of services to be exported and the
                  list of partitions to expose them to.
                items:
                  description: ExportedService manages the exporting of a service
                    in the local partition to other partitions.
                  properties:
                    consumers:
                      description: Consumers is a list of downstream consumers of
                        the service to be exported.
                      items:
                        description: ServiceConsumer represents a downstream consumer
                          of the service to be exported.
                        properties:
                          partition:
                            description: Partition is the admin partition to export
                              the service to.
                            type: string
                          peer:
                            description: '[Experimental] Peer is the name of the peer
                              to export the service to.'
                            type: string
                        type: object
                      type: array
                    name:
                      description: Name is the name of the service to be exported.
                      type: string
                    namespace:
                      description: Namespace is the namespace to export the service
                        from.
                      type: string
                  type: object
                type: array
            type: object
          status:
            properties:
              conditions:
                description: Conditions indicate the latest available observations
                  of a resource's current state.
                items:
                  description: 'Conditions define a readiness condition for a Consul
                    resource. See: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#typical-status-properties'
                  properties:
                    lastTransitionTime:
                      description: LastTransitionTime is the last time the condition
                        transitioned from one status to another.
                      format: date-time
                      type: string
                    message:
                      description: A human readable message indicating details about
                        the transition.
                      type: string
                    reason:
                      description: The reason for the condition's last transition.
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown.
                      type: string
                    type:
                      description: Type of condition.
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              lastSyncedTime:
                description: LastSyncedTime is the last time the resource successfully
                  synced with Consul.
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
# Source: consul/templates/crd-ingressgateways.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.8.0
  creationTimestamp: null
  name: ingressgateways.consul.hashicorp.com
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: crd
spec:
  group: consul.hashicorp.com
  names:
    kind: IngressGateway
    listKind: IngressGatewayList
    plural: ingressgateways
    shortNames:
    - ingress-gateway
    singular: ingressgateway
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The sync status of the resource with Consul
      jsonPath: .status.conditions[?(@.type=="Synced")].status
      name: Synced
      type: string
    - description: The last successful synced time of the resource with Consul
      jsonPath: .status.lastSyncedTime
      name: Last Synced
      type: date
    - description: The age of the resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: IngressGateway is the Schema for the ingressgateways API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: IngressGatewaySpec defines the desired state of IngressGateway.
            properties:
              defaults:
                description: Defaults is default configuration for all upstream services
                properties:
                  maxConcurrentRequests:
                    description: The maximum number of concurrent requests that will
                      be allowed at a single point in time. Use this to limit HTTP/2
                      traffic, since HTTP/2 has many requests per connection.
                    format: int32
                    type: integer
                  maxConnections:
                    description: The maximum number of connections a service instance
                      will be allowed to establish against the given upstream. Use
                      this to limit HTTP/1.1 traffic, since HTTP/1.1 has a request
                      per connection.
                    format: int32
                    type: integer
                  maxPendingRequests:
                    description: The maximum number of requests that will be queued
                      while waiting for a connection to be established.
                    format: int32
                    type: integer
                type: object
              listeners:
                description: Listeners declares what ports the ingress gateway should
                  listen on, and what services to associated to those ports.
                items:
                  description: IngressListener manages the configuration for a listener
                    on a specific port.
                  properties:
                    port:
                      description: Port declares the port on which the ingress gateway
                        should listen for traffic.
                      type: integer
                    protocol:
                      description: 'Protocol declares what type of traffic this listener
                        is expected to receive. Depending on the protocol, a listener
                        might support multiplexing services over a single port, or
                        additional discovery chain features. The current supported
                        values are: (tcp | http | http2 | grpc).'
                      type: string
                    services:
                      description: Services declares the set of services to which
                        the listener forwards traffic. For "tcp" protocol listeners,
                        only a single service is allowed. For "http" listeners, multiple
                        services can be declared.
                      items:
                        description: IngressService manages configuration for services
                          that are exposed to ingress traffic.
                        properties:
                          hosts:
                            description: "Hosts is a list of hostnames which should
                              be associated to this service on the defined listener.
                              Only allowed on layer 7 protocols, this will be used
                              to route traffic to the service by matching the Host
                              header of the HTTP request. \n If a host is provided
                              for a service that also has a wildcard specifier defined,
                              the host will override the wildcard-specifier-provided
                              \"<service-name>.*\" domain for that listener. \n This
                              cannot be specified when using the wildcard specifier,
                              \"*\", or when using a \"tcp\" listener."
                            items:
                              type: string
                            type: array
                          maxConcurrentRequests:
                            description: The maximum number of concurrent requests
                              that will be allowed at a single point in time. Use
                              this to limit HTTP/2 traffic, since HTTP/2 has many
                              requests per connection.
                            format: int32
                            type: integer
                          maxConnections:
                            description: The maximum number of connections a service
                              instance will be allowed to establish against the given
                              upstream. Use this to limit HTTP/1.1 traffic, since
                              HTTP/1.1 has a request per connection.
                            format: int32
                            type: integer
                          maxPendingRequests:
                            description: The maximum number of requests that will
                              be queued while waiting for a connection to be established.
                            format: int32
                            type: integer
                          name:
                            description: "Name declares the service to which traffic
                              should be forwarded. \n This can either be a specific
                              service, or the wildcard specifier, \"*\". If the wildcard
                              specifier is provided, the listener must be of \"http\"
                              protocol and means that the listener will forward traffic
                              to all services. \n A name can be specified on multiple
                              listeners, and will be exposed on both of the listeners."
                            type: string
                          namespace:
                            description: Namespace is the namespace where the service
                              is located. Namespacing is a Consul Enterprise feature.
                            type: string
                          partition:
                            description: Partition is the admin-partition where the
                              service is located. Partitioning is a Consul Enterprise
                              feature.
                            type: string
                          requestHeaders:
                            description: Allow HTTP header manipulation to be configured.
                            properties:
                              add:
                                additionalProperties:
                                  type: string
                                description: Add is a set of name -> value pairs that
                                  should be appended to the request or response (i.e.
                                  allowing duplicates if the same header already exists).
                                type: object
                              remove:
                                description: Remove is the set of header names that
                                  should be stripped from the request or response.
                                items:
                                  type: string
                                type: array
                              set:
                                additionalProperties:
                                  type: string
                                description: Set is a set of name -> value pairs that
                                  should be added to the request or response, overwriting
                                  any existing header values of the same name.
                                type: object
                            type: object
                          responseHeaders:
                            description: HTTPHeaderModifiers is a set of rules for
                              HTTP header modification that should be performed by
                              proxies as the request passes through them. It can operate
                              on either request or response headers depending on the
                              context in which it is used.
                            properties:
                              add:
                                additionalProperties:
                                  type: string
                                description: Add is a set of name -> value pairs that
                                  should be appended to the request or response (i.e.
                                  allowing duplicates if the same header already exists).
                                type: object
                              remove:
                                description: Remove is the set of header names that
                                  should be stripped from the request or response.
                                items:
                                  type: string
                                type: array
                              set:
                                additionalProperties:
                                  type: string
                                description: Set is a set of name -> value pairs that
                                  should be added to the request or response, overwriting
                                  any existing header values of the same name.
                                type: object
                            type: object
                          tls:
                            description: TLS allows specifying some TLS configuration
                              per listener.
                            properties:
                              sds:
                                description: SDS allows configuring TLS certificate
                                  from an SDS service.
                                properties:
                                  certResource:
                                    description: CertResource is the SDS resource
                                      name to request when fetching the certificate
                                      from the SDS service.
                                    type: string
                                  clusterName:
                                    description: ClusterName is the SDS cluster name
                                      to connect to, to retrieve certificates. This
                                      cluster must be specified in the Gateway's bootstrap
                                      configuration.
                                    type: string
                                type: object
                            type: object
                        type: object
                      type: array
                    tls:
                      description: TLS config for this listener.
                      properties:
                        cipherSuites:
                          description: Define a subset of cipher suites to restrict
                            Only applicable to connections negotiated via TLS 1.2
                            or earlier.
                          items:
                            type: string
                          type: array
                        enabled:
                          description: Indicates that TLS should be enabled for this
                            gateway service.
                          type: boolean
                        sds:
                          description: SDS allows configuring TLS certificate from
                            an SDS service.
                          properties:
                            certResource:
                              description: CertResource is the SDS resource name to
                                request when fetching the certificate from the SDS
                                service.
                              type: string
                            clusterName:
                              description: ClusterName is the SDS cluster name to
                                connect to, to retrieve certificates. This cluster
                                must be specified in the Gateway's bootstrap configuration.
                              type: string
                          type: object
                        tlsMaxVersion:
                          description: TLSMaxVersion sets the default maximum TLS
                            version supported. Must be greater than or equal to `TLSMinVersion`.
                            One of `TLS_AUTO`, `TLSv1_0`, `TLSv1_1`, `TLSv1_2`, or
                            `TLSv1_3`. If unspecified, Envoy will default to TLS 1.3
                            as a max version for incoming connections.
                          type: string
                        tlsMinVersion:
                          description: TLSMinVersion sets the default minimum TLS
                            version supported. One of `TLS_AUTO`, `TLSv1_0`, `TLSv1_1`,
                            `TLSv1_2`, or `TLSv1_3`. If unspecified, Envoy v1.22.0
                            and newer will default to TLS 1.2 as a min version, while
                            older releases of Envoy default to TLS 1.0.
                          type: string
                      required:
                      - enabled
                      type: object
                  type: object
                type: array
              tls:
                description: TLS holds the TLS configuration for this gateway.
                properties:
                  cipherSuites:
                    description: Define a subset of cipher suites to restrict Only
                      applicable to connections negotiated via TLS 1.2 or earlier.
                    items:
                      type: string
                    type: array
                  enabled:
                    description: Indicates that TLS should be enabled for this gateway
                      service.
                    type: boolean
                  sds:
                    description: SDS allows configuring TLS certificate from an SDS
                      service.
                    properties:
                      certResource:
                        description: CertResource is the SDS resource name to request
                          when fetching the certificate from the SDS service.
                        type: string
                      clusterName:
                        description: ClusterName is the SDS cluster name to connect
                          to, to retrieve certificates. This cluster must be specified
                          in the Gateway's bootstrap configuration.
                        type: string
                    type: object
                  tlsMaxVersion:
                    description: TLSMaxVersion sets the default maximum TLS version
                      supported. Must be greater than or equal to `TLSMinVersion`.
                      One of `TLS_AUTO`, `TLSv1_0`, `TLSv1_1`, `TLSv1_2`, or `TLSv1_3`.
                      If unspecified, Envoy will default to TLS 1.3 as a max version
                      for incoming connections.
                    type: string
                  tlsMinVersion:
                    description: TLSMinVersion sets the default minimum TLS version
                      supported. One of `TLS_AUTO`, `TLSv1_0`, `TLSv1_1`, `TLSv1_2`,
                      or `TLSv1_3`. If unspecified, Envoy v1.22.0 and newer will default
                      to TLS 1.2 as a min version, while older releases of Envoy default
                      to TLS 1.0.
                    type: string
                required:
                - enabled
                type: object
            type: object
          status:
            properties:
              conditions:
                description: Conditions indicate the latest available observations
                  of a resource's current state.
                items:
                  description: 'Conditions define a readiness condition for a Consul
                    resource. See: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#typical-status-properties'
                  properties:
                    lastTransitionTime:
                      description: LastTransitionTime is the last time the condition
                        transitioned from one status to another.
                      format: date-time
                      type: string
                    message:
                      description: A human readable message indicating details about
                        the transition.
                      type: string
                    reason:
                      description: The reason for the condition's last transition.
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown.
                      type: string
                    type:
                      description: Type of condition.
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              lastSyncedTime:
                description: LastSyncedTime is the last time the resource successfully
                  synced with Consul.
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
# Source: consul/templates/crd-meshes.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.8.0
  creationTimestamp: null
  name: meshes.consul.hashicorp.com
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: crd
spec:
  group: consul.hashicorp.com
  names:
    kind: Mesh
    listKind: MeshList
    plural: meshes
    singular: mesh
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The sync status of the resource with Consul
      jsonPath: .status.conditions[?(@.type=="Synced")].status
      name: Synced
      type: string
    - description: The last successful synced time of the resource with Consul
      jsonPath: .status.lastSyncedTime
      name: Last Synced
      type: date
    - description: The age of the resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Mesh is the Schema for the mesh API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: MeshSpec defines the desired state of Mesh.
            properties:
              http:
                description: HTTP defines the HTTP configuration for the service mesh.
                properties:
                  sanitizeXForwardedClientCert:
                    type: boolean
                required:
                - sanitizeXForwardedClientCert
                type: object
              peering:
                description: Peering defines the peering configuration for the service
                  mesh.
                properties:
                  peerThroughMeshGateways:
                    description: PeerThroughMeshGateways determines whether peering
                      traffic between control planes should flow through mesh gateways.
                      If enabled, Consul servers will advertise mesh gateway addresses
                      as their own. Additionally, mesh gateways will configure themselves
                      to expose the local servers using a peering-specific SNI.
                    type: boolean
                type: object
              tls:
                description: TLS defines the TLS configuration for the service mesh.
                properties:
                  incoming:
                    description: Incoming defines the TLS configuration for inbound
                      mTLS connections targeting the public listener on Connect and
                      TerminatingGateway proxy kinds.
                    properties:
                      cipherSuites:
                        description: CipherSuites sets the default list of TLS cipher
                          suites to support when negotiating connections using TLS
                          1.2 or earlier. If unspecified, Envoy will use a default
                          server cipher list. The list of supported cipher suites
                          can be seen in https://github.com/hashicorp/consul/blob/v1.11.2/types/tls.go#L154-L169
                          and is dependent on underlying support in Envoy. Future
                          releases of Envoy may remove currently-supported but insecure
                          cipher suites, and future releases of Consul may add new
                          supported cipher suites if any are added to Envoy.
                        items:
                          type: string
                        type: array
                      tlsMaxVersion:
                        description: TLSMaxVersion sets the default maximum TLS version
                          supported. Must be greater than or equal to `TLSMinVersion`.
                          One of `TLS_AUTO`, `TLSv1_0`, `TLSv1_1`, `TLSv1_2`, or `TLSv1_3`.
                          If unspecified, Envoy will default to TLS 1.3 as a max version
                          for incoming connections.
                        type: string
                      tlsMinVersion:
                        description: TLSMinVersion sets the default minimum TLS version
                          supported. One of `TLS_AUTO`, `TLSv1_0`, `TLSv1_1`, `TLSv1_2`,
                          or `TLSv1_3`. If unspecified, Envoy v1.22.0 and newer will
                          default to TLS 1.2 as a min version, while older releases
                          of Envoy default to TLS 1.0.
                        type: string
                    type: object
                  outgoing:
                    description: Outgoing defines the TLS configuration for outbound
                      mTLS connections dialing upstreams from Connect and IngressGateway
                      proxy kinds.
                    properties:
                      cipherSuites:
                        description: CipherSuites sets the default list of TLS cipher
                          suites to support when negotiating connections using TLS
                          1.2 or earlier. If unspecified, Envoy will use a default
                          server cipher list. The list of supported cipher suites
                          can be seen in https://github.com/hashicorp/consul/blob/v1.11.2/types/tls.go#L154-L169
                          and is dependent on underlying support in Envoy. Future
                          releases of Envoy may remove currently-supported but insecure
                          cipher suites, and future releases of Consul may add new
                          supported cipher suites if any are added to Envoy.
                        items:
                          type: string
                        type: array
                      tlsMaxVersion:
                        description: TLSMaxVersion sets the default maximum TLS version
                          supported. Must be greater than or equal to `TLSMinVersion`.
                          One of `TLS_AUTO`, `TLSv1_0`, `TLSv1_1`, `TLSv1_2`, or `TLSv1_3`.
                          If unspecified, Envoy will default to TLS 1.3 as a max version
                          for incoming connections.
                        type: string
                      tlsMinVersion:
                        description: TLSMinVersion sets the default minimum TLS version
                          supported. One of `TLS_AUTO`, `TLSv1_0`, `TLSv1_1`, `TLSv1_2`,
                          or `TLSv1_3`. If unspecified, Envoy v1.22.0 and newer will
                          default to TLS 1.2 as a min version, while older releases
                          of Envoy default to TLS 1.0.
                        type: string
                    type: object
                type: object
              transparentProxy:
                description: TransparentProxy controls the configuration specific
                  to proxies in "transparent" mode. Added in v1.10.0.
                properties:
                  meshDestinationsOnly:
                    description: MeshDestinationsOnly determines whether sidecar proxies
                      operating in "transparent" mode can proxy traffic to IP addresses
                      not registered in Consul's catalog. If enabled, traffic will
                      only be proxied to upstreams with service registrations in the
                      catalog.
                    type: boolean
                type: object
            type: object
          status:
            properties:
              conditions:
                description: Conditions indicate the latest available observations
                  of a resource's current state.
                items:
                  description: 'Conditions define a readiness condition for a Consul
                    resource. See: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#typical-status-properties'
                  properties:
                    lastTransitionTime:
                      description: LastTransitionTime is the last time the condition
                        transitioned from one status to another.
                      format: date-time
                      type: string
                    message:
                      description: A human readable message indicating details about
                        the transition.
                      type: string
                    reason:
                      description: The reason for the condition's last transition.
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown.
                      type: string
                    type:
                      description: Type of condition.
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              lastSyncedTime:
                description: LastSyncedTime is the last time the resource successfully
                  synced with Consul.
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
# Source: consul/templates/crd-peeringacceptors.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.8.0
  creationTimestamp: null
  name: peeringacceptors.consul.hashicorp.com
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: crd
spec:
  group: consul.hashicorp.com
  names:
    kind: PeeringAcceptor
    listKind: PeeringAcceptorList
    plural: peeringacceptors
    shortNames:
    - peering-acceptor
    singular: peeringacceptor
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The sync status of the resource with Consul
      jsonPath: .status.conditions[?(@.type=="Synced")].status
      name: Synced
      type: string
    - description: The last successful synced time of the resource with Consul
      jsonPath: .status.lastSyncedTime
      name: Last Synced
      type: date
    - description: The age of the resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: PeeringAcceptor is the Schema for the peeringacceptors API.
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: PeeringAcceptorSpec defines the desired state of PeeringAcceptor.
            properties:
              peer:
                description: Peer describes the information needed to create a peering.
                properties:
                  secret:
                    description: Secret describes how to store the generated peering
                      token.
                    properties:
                      backend:
                        description: 'Backend is where the generated secret is stored.
                          Currently supports the value: "kubernetes".'
                        type: string
                      key:
                        description: Key is the key of the secret generated.
                        type: string
                      name:
                        description: Name is the name of the secret generated.
                        type: string
                    type: object
                type: object
            required:
            - peer
            type: object
          status:
            description: PeeringAcceptorStatus defines the observed state of PeeringAcceptor.
            properties:
              conditions:
                description: Conditions indicate the latest available observations
                  of a resource's current state.
                items:
                  description: 'Conditions define a readiness condition for a Consul
                    resource. See: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#typical-status-properties'
                  properties:
                    lastTransitionTime:
                      description: LastTransitionTime is the last time the condition
                        transitioned from one status to another.
                      format: date-time
                      type: string
                    message:
                      description: A human readable message indicating details about
                        the transition.
                      type: string
                    reason:
                      description: The reason for the condition's last transition.
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown.
                      type: string
                    type:
                      description: Type of condition.
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              lastSyncedTime:
                description: LastSyncedTime is the last time the resource successfully
                  synced with Consul.
                format: date-time
                type: string
              latestPeeringVersion:
                description: LatestPeeringVersion is the latest version of the resource
                  that was reconciled.
                format: int64
                type: integer
              secret:
                description: SecretRef shows the status of the secret.
                properties:
                  backend:
                    description: 'Backend is where the generated secret is stored.
                      Currently supports the value: "kubernetes".'
                    type: string
                  key:
                    description: Key is the key of the secret generated.
                    type: string
                  name:
                    description: Name is the name of the secret generated.
                    type: string
                  resourceVersion:
                    description: ResourceVersion is the resource version for the secret.
                    type: string
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
# Source: consul/templates/crd-peeringdialers.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.8.0
  creationTimestamp: null
  name: peeringdialers.consul.hashicorp.com
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: crd
spec:
  group: consul.hashicorp.com
  names:
    kind: PeeringDialer
    listKind: PeeringDialerList
    plural: peeringdialers
    shortNames:
    - peering-dialer
    singular: peeringdialer
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The sync status of the resource with Consul
      jsonPath: .status.conditions[?(@.type=="Synced")].status
      name: Synced
      type: string
    - description: The last successful synced time of the resource with Consul
      jsonPath: .status.lastSyncedTime
      name: Last Synced
      type: date
    - description: The age of the resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: PeeringDialer is the Schema for the peeringdialers API.
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: PeeringDialerSpec defines the desired state of PeeringDialer.
            properties:
              peer:
                description: Peer describes the information needed to create a peering.
                properties:
                  secret:
                    description: Secret describes how to store the generated peering
                      token.
                    properties:
                      backend:
                        description: 'Backend is where the generated secret is stored.
                          Currently supports the value: "kubernetes".'
                        type: string
                      key:
                        description: Key is the key of the secret generated.
                        type: string
                      name:
                        description: Name is the name of the secret generated.
                        type: string
                    type: object
                type: object
            required:
            - peer
            type: object
          status:
            description: PeeringDialerStatus defines the observed state of PeeringDialer.
            properties:
              conditions:
                description: Conditions indicate the latest available observations
                  of a resource's current state.
                items:
                  description: 'Conditions define a readiness condition for a Consul
                    resource. See: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#typical-status-properties'
                  properties:
                    lastTransitionTime:
                      description: LastTransitionTime is the last time the condition
                        transitioned from one status to another.
                      format: date-time
                      type: string
                    message:
                      description: A human readable message indicating details about
                        the transition.
                      type: string
                    reason:
                      description: The reason for the condition's last transition.
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown.
                      type: string
                    type:
                      description: Type of condition.
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              lastSyncedTime:
                description: LastSyncedTime is the last time the resource successfully
                  synced with Consul.
                format: date-time
                type: string
              latestPeeringVersion:
                description: LatestPeeringVersion is the latest version of the resource
                  that was reconciled.
                format: int64
                type: integer
              secret:
                description: SecretRef shows the status of the secret.
                properties:
                  backend:
                    description: 'Backend is where the generated secret is stored.
                      Currently supports the value: "kubernetes".'
                    type: string
                  key:
                    description: Key is the key of the secret generated.
                    type: string
                  name:
                    description: Name is the name of the secret generated.
                    type: string
                  resourceVersion:
                    description: ResourceVersion is the resource version for the secret.
                    type: string
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
# Source: consul/templates/crd-proxydefaults.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.8.0
  creationTimestamp: null
  name: proxydefaults.consul.hashicorp.com
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: crd
spec:
  group: consul.hashicorp.com
  names:
    kind: ProxyDefaults
    listKind: ProxyDefaultsList
    plural: proxydefaults
    shortNames:
    - proxy-defaults
    singular: proxydefaults
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The sync status of the resource with Consul
      jsonPath: .status.conditions[?(@.type=="Synced")].status
      name: Synced
      type: string
    - description: The last successful synced time of the resource with Consul
      jsonPath: .status.lastSyncedTime
      name: Last Synced
      type: date
    - description: The age of the resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ProxyDefaults is the Schema for the proxydefaults API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: ProxyDefaultsSpec defines the desired state of ProxyDefaults.
            properties:
              config:
                description: Config is an arbitrary map of configuration values used
                  by Connect proxies. Any values that your proxy allows can be configured
                  globally here. Supports JSON config values. See https://www.consul.io/docs/connect/proxies/envoy#configuration-formatting
                type: object
                x-kubernetes-preserve-unknown-fields: true
              expose:
                description: Expose controls the default expose path configuration
                  for Envoy.
                properties:
                  checks:
                    description: Checks defines whether paths associated with Consul
                      checks will be exposed. This flag triggers exposing all HTTP
                      and GRPC check paths registered for the service.
                    type: boolean
                  paths:
                    description: Paths is the list of paths exposed through the proxy.
                    items:
                      properties:
                        listenerPort:
                          description: ListenerPort defines the port of the proxy's
                            listener for exposed paths.
                          type: integer
                        localPathPort:
                          description: LocalPathPort is the port that the service
                            is listening on for the given path.
                          type: integer
                        path:
                          description: Path is the path to expose through the proxy,
                            ie. "/metrics".
                          type: string
                        protocol:
                          description: Protocol describes the upstream's service protocol.
                            Valid values are "http" and "http2", defaults to "http".
                          type: string
                      type: object
                    type: array
                type: object
              meshGateway:
                description: MeshGateway controls the default mesh gateway configuration
                  for this service.
                properties:
                  mode:
                    description: Mode is the mode that should be used for the upstream
                      connection. One of none, local, or remote.
                    type: string
                type: object
              mode:
                description: 'Mode can be one of "direct" or "transparent". "transparent"
                  represents that inbound and outbound application traffic is being
                  captured and redirected through the proxy. This mode does not enable
                  the traffic redirection itself. Instead it signals Consul to configure
                  Envoy as if traffic is already being redirected. "direct" represents
                  that the proxy''s listeners must be dialed directly by the local
                  application and other proxies. Note: This cannot be set using the
                  CRD and should be set using annotations on the services that are
                  part of the mesh.'
                type: string
              transparentProxy:
                description: 'TransparentProxy controls configuration specific to
                  proxies in transparent mode. Note: This cannot be set using the
                  CRD and should be set using annotations on the services that are
                  part of the mesh.'
                properties:
                  dialedDirectly:
                    description: DialedDirectly indicates whether transparent proxies
                      can dial this proxy instance directly. The discovery chain is
                      not considered when dialing a service instance directly. This
                      setting is useful when addressing stateful services, such as
                      a database cluster with a leader node.
                    type: boolean
                  outboundListenerPort:
                    description: OutboundListenerPort is the port of the listener
                      where outbound application traffic is being redirected to.
                    type: integer
                type: object
            type: object
          status:
            properties:
              conditions:
                description: Conditions indicate the latest available observations
                  of a resource's current state.
                items:
                  description: 'Conditions define a readiness condition for a Consul
                    resource. See: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#typical-status-properties'
                  properties:
                    lastTransitionTime:
                      description: LastTransitionTime is the last time the condition
                        transitioned from one status to another.
                      format: date-time
                      type: string
                    message:
                      description: A human readable message indicating details about
                        the transition.
                      type: string
                    reason:
                      description: The reason for the condition's last transition.
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown.
                      type: string
                    type:
                      description: Type of condition.
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              lastSyncedTime:
                description: LastSyncedTime is the last time the resource successfully
                  synced with Consul.
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
# Source: consul/templates/crd-servicedefaults.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.8.0
  creationTimestamp: null
  name: servicedefaults.consul.hashicorp.com
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: crd
spec:
  group: consul.hashicorp.com
  names:
    kind: ServiceDefaults
    listKind: ServiceDefaultsList
    plural: servicedefaults
    shortNames:
    - service-defaults
    singular: servicedefaults
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The sync status of the resource with Consul
      jsonPath: .status.conditions[?(@.type=="Synced")].status
      name: Synced
      type: string
    - description: The last successful synced time of the resource with Consul
      jsonPath: .status.lastSyncedTime
      name: Last Synced
      type: date
    - description: The age of the resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ServiceDefaults is the Schema for the servicedefaults API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: ServiceDefaultsSpec defines the desired state of ServiceDefaults.
            properties:
              destination:
                description: Destination is an address(es)/port combination that represents
                  an endpoint outside the mesh. This is only valid when the mesh is
                  configured in "transparent" mode. Destinations live outside of Consul's
                  catalog, and because of this, they do not require an artificial
                  node to be created.
                properties:
                  addresses:
                    description: Addresses is a list of IPs and/or hostnames that
                      can be dialed and routed through a terminating gateway.
                    items:
                      type: string
                    type: array
                  port:
                    description: Port is the port that can be dialed on any of the
                      addresses in this Destination.
                    format: int32
                    type: integer
                type: object
              expose:
                description: Expose controls the default expose path configuration
                  for Envoy.
                properties:
                  checks:
                    description: Checks defines whether paths associated with Consul
                      checks will be exposed. This flag triggers exposing all HTTP
                      and GRPC check paths registered for the service.
                    type: boolean
                  paths:
                    description: Paths is the list of paths exposed through the proxy.
                    items:
                      properties:
                        listenerPort:
                          description: ListenerPort defines the port of the proxy's
                            listener for exposed paths.
                          type: integer
                        localPathPort:
                          description: LocalPathPort is the port that the service
                            is listening on for the given path.
                          type: integer
                        path:
                          description: Path is the path to expose through the proxy,
                            ie. "/metrics".
                          type: string
                        protocol:
                          description: Protocol describes the upstream's service protocol.
                            Valid values are "http" and "http2", defaults to "http".
                          type: string
                      type: object
                    type: array
                type: object
              externalSNI:
                description: ExternalSNI is an optional setting that allows for the
                  TLS SNI value to be changed to a non-connect value when federating
                  with an external system.
                type: string
              localConnectTimeoutMs:
                description: The number of milliseconds allowed to make connections
                  to the local application instance before timing out. Defaults to
                  5000.
                type: integer
              localRequestTimeoutMs:
                description: In milliseconds, the timeout for HTTP requests to the
                  local application instance. Applies to HTTP-based protocols only.
                  If not specified, inherits the Envoy default for route timeouts
                  (15s).
                type: integer
              maxInboundConnections:
                description: MaxInboundConnections is the maximum number of concurrent
                  inbound connections to each service instance. Defaults to 0 (using
                  consul's default) if not set.
                type: integer
              meshGateway:
                description: MeshGateway controls the default mesh gateway configuration
                  for this service.
                properties:
                  mode:
                    description: Mode is the mode that should be used for the upstream
                      connection. One of none, local, or remote.
                    type: string
                type: object
              mode:
                description: 'Mode can be one of "direct" or "transparent". "transparent"
                  represents that inbound and outbound application traffic is being
                  captured and redirected through the proxy. This mode does not enable
                  the traffic redirection itself. Instead it signals Consul to configure
                  Envoy as if traffic is already being redirected. "direct" represents
                  that the proxy''s listeners must be dialed directly by the local
                  application and other proxies. Note: This cannot be set using the
                  CRD and should be set using annotations on the services that are
                  part of the mesh.'
                type: string
              protocol:
                description: Protocol sets the protocol of the service. This is used
                  by Connect proxies for things like observability features and to
                  unlock usage of the service-splitter and service-router config entries
                  for a service.
                type: string
              transparentProxy:
                description: 'TransparentProxy controls configuration specific to
                  proxies in transparent mode. Note: This cannot be set using the
                  CRD and should be set using annotations on the services that are
                  part of the mesh.'
                properties:
                  dialedDirectly:
                    description: DialedDirectly indicates whether transparent proxies
                      can dial this proxy instance directly. The discovery chain is
                      not considered when dialing a service instance directly. This
                      setting is useful when addressing stateful services, such as
                      a database cluster with a leader node.
                    type: boolean
                  outboundListenerPort:
                    description: OutboundListenerPort is the port of the listener
                      where outbound application traffic is being redirected to.
                    type: integer
                type: object
              upstreamConfig:
                description: UpstreamConfig controls default configuration settings
                  that apply across all upstreams, and per-upstream configuration
                  overrides. Note that per-upstream configuration applies across all
                  federated datacenters to the pairing of source and upstream destination
                  services.
                properties:
                  defaults:
                    description: Defaults contains default configuration for all upstreams
                      of a given service. The name field must be empty.
                    properties:
                      connectTimeoutMs:
                        description: ConnectTimeoutMs is the number of milliseconds
                          to timeout making a new connection to this upstream. Defaults
                          to 5000 (5 seconds) if not set.
                        type: integer
                      envoyClusterJSON:
                        description: 'EnvoyClusterJSON is a complete override ("escape
                          hatch") for the upstream''s cluster. The Connect client
                          TLS certificate and context will be injected overriding
                          any TLS settings present. Note: This escape hatch is NOT
                          compatible with the discovery chain and will be ignored
                          if a discovery chain is active.'
                        type: string
                      envoyListenerJSON:
                        description: 'EnvoyListenerJSON is a complete override ("escape
                          hatch") for the upstream''s listener. Note: This escape
                          hatch is NOT compatible with the discovery chain and will
                          be ignored if a discovery chain is active.'
                        type: string
                      limits:
                        description: Limits are the set of limits that are applied
                          to the proxy for a specific upstream of a service instance.
                        properties:
                          maxConcurrentRequests:
                            description: MaxConcurrentRequests is the maximum number
                              of in-flight requests that will be allowed to the upstream
                              cluster at a point in time. This is mostly applicable
                              to HTTP/2 clusters since all HTTP/1.1 requests are limited
                              by MaxConnections.
                            type: integer
                          maxConnections:
                            description: MaxConnections is the maximum number of connections
                              the local proxy can make to the upstream service.
                            type: integer
                          maxPendingRequests:
                            description: MaxPendingRequests is the maximum number
                              of requests that will be queued waiting for an available
                              connection. This is mostly applicable to HTTP/1.1 clusters
                              since all HTTP/2 requests are streamed over a single
                              connection.
                            type: integer
                        type: object
                      meshGateway:
                        description: MeshGatewayConfig controls how Mesh Gateways
                          are configured and used.
                        properties:
                          mode:
                            description: Mode is the mode that should be used for
                              the upstream connection. One of none, local, or remote.
                            type: string
                        type: object
                      name:
                        description: Name is only accepted within a service-defaults
                          config entry.
                        type: string
                      namespace:
                        description: Namespace is only accepted within a service-defaults
                          config entry.
                        type: string
                      partition:
                        description: Partition is only accepted within a service-defaults
                          config entry.
                        type: string
                      passiveHealthCheck:
                        description: PassiveHealthCheck configuration determines how
                          upstream proxy instances will be monitored for removal from
                          the load balancing pool.
                        properties:
                          enforcing_consecutive_5xx:
                            description: EnforcingConsecutive5xx is the % chance that
                              a host will be actually ejected when an outlier status
                              is detected through consecutive 5xx. This setting can
                              be used to disable ejection or to ramp it up slowly.
                            format: int32
                            type: integer
                          interval:
                            description: Interval between health check analysis sweeps.
                              Each sweep may remove hosts or return hosts to the pool.
                            type: string
                          maxFailures:
                            description: MaxFailures is the count of consecutive failures
                              that results in a host being removed from the pool.
                            format: int32
                            type: integer
                        type: object
                      protocol:
                        description: Protocol describes the upstream's service protocol.
                          Valid values are "tcp", "http" and "grpc". Anything else
                          is treated as tcp. This enables protocol aware features
                          like per-request metrics and connection pooling, tracing,
                          routing etc.
                        type: string
                    type: object
                  overrides:
                    description: Overrides is a slice of per-service configuration.
                      The name field is required.
                    items:
                      properties:
                        connectTimeoutMs:
                          description: ConnectTimeoutMs is the number of milliseconds
                            to timeout making a new connection to this upstream. Defaults
                            to 5000 (5 seconds) if not set.
                          type: integer
                        envoyClusterJSON:
                          description: 'EnvoyClusterJSON is a complete override ("escape
                            hatch") for the upstream''s cluster. The Connect client
                            TLS certificate and context will be injected overriding
                            any TLS settings present. Note: This escape hatch is NOT
                            compatible with the discovery chain and will be ignored
                            if a discovery chain is active.'
                          type: string
                        envoyListenerJSON:
                          description: 'EnvoyListenerJSON is a complete override ("escape
                            hatch") for the upstream''s listener. Note: This escape
                            hatch is NOT compatible with the discovery chain and will
                            be ignored if a discovery chain is active.'
                          type: string
                        limits:
                          description: Limits are the set of limits that are applied
                            to the proxy for a specific upstream of a service instance.
                          properties:
                            maxConcurrentRequests:
                              description: MaxConcurrentRequests is the maximum number
                                of in-flight requests that will be allowed to the
                                upstream cluster at a point in time. This is mostly
                                applicable to HTTP/2 clusters since all HTTP/1.1 requests
                                are limited by MaxConnections.
                              type: integer
                            maxConnections:
                              description: MaxConnections is the maximum number of
                                connections the local proxy can make to the upstream
                                service.
                              type: integer
                            maxPendingRequests:
                              description: MaxPendingRequests is the maximum number
                                of requests that will be queued waiting for an available
                                connection. This is mostly applicable to HTTP/1.1
                                clusters since all HTTP/2 requests are streamed over
                                a single connection.
                              type: integer
                          type: object
                        meshGateway:
                          description: MeshGatewayConfig controls how Mesh Gateways
                            are configured and used.
                          properties:
                            mode:
                              description: Mode is the mode that should be used for
                                the upstream connection. One of none, local, or remote.
                              type: string
                          type: object
                        name:
                          description: Name is only accepted within a service-defaults
                            config entry.
                          type: string
                        namespace:
                          description: Namespace is only accepted within a service-defaults
                            config entry.
                          type: string
                        partition:
                          description: Partition is only accepted within a service-defaults
                            config entry.
                          type: string
                        passiveHealthCheck:
                          description: PassiveHealthCheck configuration determines
                            how upstream proxy instances will be monitored for removal
                            from the load balancing pool.
                          properties:
                            enforcing_consecutive_5xx:
                              description: EnforcingConsecutive5xx is the % chance
                                that a host will be actually ejected when an outlier
                                status is detected through consecutive 5xx. This setting
                                can be used to disable ejection or to ramp it up slowly.
                              format: int32
                              type: integer
                            interval:
                              description: Interval between health check analysis
                                sweeps. Each sweep may remove hosts or return hosts
                                to the pool.
                              type: string
                            maxFailures:
                              description: MaxFailures is the count of consecutive
                                failures that results in a host being removed from
                                the pool.
                              format: int32
                              type: integer
                          type: object
                        protocol:
                          description: Protocol describes the upstream's service protocol.
                            Valid values are "tcp", "http" and "grpc". Anything else
                            is treated as tcp. This enables protocol aware features
                            like per-request metrics and connection pooling, tracing,
                            routing etc.
                          type: string
                      type: object
                    type: array
                type: object
            type: object
          status:
            properties:
              conditions:
                description: Conditions indicate the latest available observations
                  of a resource's current state.
                items:
                  description: 'Conditions define a readiness condition for a Consul
                    resource. See: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#typical-status-properties'
                  properties:
                    lastTransitionTime:
                      description: LastTransitionTime is the last time the condition
                        transitioned from one status to another.
                      format: date-time
                      type: string
                    message:
                      description: A human readable message indicating details about
                        the transition.
                      type: string
                    reason:
                      description: The reason for the condition's last transition.
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown.
                      type: string
                    type:
                      description: Type of condition.
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              lastSyncedTime:
                description: LastSyncedTime is the last time the resource successfully
                  synced with Consul.
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
# Source: consul/templates/crd-serviceintentions.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.8.0
  creationTimestamp: null
  name: serviceintentions.consul.hashicorp.com
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: crd
spec:
  group: consul.hashicorp.com
  names:
    kind: ServiceIntentions
    listKind: ServiceIntentionsList
    plural: serviceintentions
    shortNames:
    - service-intentions
    singular: serviceintentions
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The sync status of the resource with Consul
      jsonPath: .status.conditions[?(@.type=="Synced")].status
      name: Synced
      type: string
    - description: The last successful synced time of the resource with Consul
      jsonPath: .status.lastSyncedTime
      name: Last Synced
      type: date
    - description: The age of the resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ServiceIntentions is the Schema for the serviceintentions API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: ServiceIntentionsSpec defines the desired state of ServiceIntentions.
            properties:
              destination:
                description: Destination is the intention destination that will have
                  the authorization granted to.
                properties:
                  name:
                    description: Name is the destination of all intentions defined
                      in this config entry. This may be set to the wildcard character
                      (*) to match all services that don't otherwise have intentions
                      defined.
                    type: string
                  namespace:
                    description: Namespace specifies the namespace the config entry
                      will apply to. This may be set to the wildcard character (*)
                      to match all services in all namespaces that don't otherwise
                      have intentions defined.
                    type: string
                type: object
              sources:
                description: Sources is the list of all intention sources and the
                  authorization granted to those sources. The order of this list does
                  not matter, but out of convenience Consul will always store this
                  reverse sorted by intention precedence, as that is the order that
                  they will be evaluated at enforcement time.
                items:
                  properties:
                    action:
                      description: Action is required for an L4 intention, and should
                        be set to one of "allow" or "deny" for the action that should
                        be taken if this intention matches a request.
                      type: string
                    description:
                      description: Description for the intention. This is not used
                        by Consul, but is presented in API responses to assist tooling.
                      type: string
                    name:
                      description: Name is the source of the intention. This is the
                        name of a Consul service. The service doesn't need to be registered.
                      type: string
                    namespace:
                      description: Namespace is the namespace for the Name parameter.
                      type: string
                    partition:
                      description: Partition is the Admin Partition for the Name parameter.
                      type: string
                    peer:
                      description: '[Experimental] Peer is the peer name for the Name
                        parameter.'
                      type: string
                    permissions:
                      description: Permissions is the list of all additional L7 attributes
                        that extend the intention match criteria. Permission precedence
                        is applied top to bottom. For any given request the first
                        permission to match in the list is terminal and stops further
                        evaluation. As with L4 intentions, traffic that fails to match
                        any of the provided permissions in this intention will be
                        subject to the default intention behavior is defined by the
                        default ACL policy. This should be omitted for an L4 intention
                        as it is mutually exclusive with the Action field.
                      items:
                        properties:
                          action:
                            description: Action is one of "allow" or "deny" for the
                              action that should be taken if this permission matches
                              a request.
                            type: string
                          http:
                            description: HTTP is a set of HTTP-specific authorization
                              criteria.
                            properties:
                              header:
                                description: Header is a set of criteria that can
                                  match on HTTP request headers. If more than one
                                  is configured all must match for the overall match
                                  to apply.
                                items:
                                  properties:
                                    exact:
                                      description: Exact matches if the header with
                                        the given name is this value.
                                      type: string
                                    invert:
                                      description: Invert inverts the logic of the
                                        match.
                                      type: boolean
                                    name:
                                      description: Name is the name of the header
                                        to match.
                                      type: string
                                    prefix:
                                      description: Prefix matches if the header with
                                        the given name has this prefix.
                                      type: string
                                    present:
                                      description: Present matches if the header with
                                        the given name is present with any value.
                                      type: boolean
                                    regex:
                                      description: Regex matches if the header with
                                        the given name matches this pattern.
                                      type: string
                                    suffix:
                                      description: Suffix matches if the header with
                                        the given name has this suffix.
                                      type: string
                                  type: object
                                type: array
                              methods:
                                description: Methods is a list of HTTP methods for
                                  which this match applies. If unspecified all HTTP
                                  methods are matched. If provided the names must
                                  be a valid method.
                                items:
                                  type: string
                                type: array
                              pathExact:
                                description: PathExact is the exact path to match
                                  on the HTTP request path.
                                type: string
                              pathPrefix:
                                description: PathPrefix is the path prefix to match
                                  on the HTTP request path.
                                type: string
                              pathRegex:
                                description: PathRegex is the regular expression to
                                  match on the HTTP request path.
                                type: string
                            type: object
                        type: object
                      type: array
                  type: object
                type: array
            type: object
          status:
            properties:
              conditions:
                description: Conditions indicate the latest available observations
                  of a resource's current state.
                items:
                  description: 'Conditions define a readiness condition for a Consul
                    resource. See: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#typical-status-properties'
                  properties:
                    lastTransitionTime:
                      description: LastTransitionTime is the last time the condition
                        transitioned from one status to another.
                      format: date-time
                      type: string
                    message:
                      description: A human readable message indicating details about
                        the transition.
                      type: string
                    reason:
                      description: The reason for the condition's last transition.
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown.
                      type: string
                    type:
                      description: Type of condition.
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              lastSyncedTime:
                description: LastSyncedTime is the last time the resource successfully
                  synced with Consul.
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
# Source: consul/templates/crd-serviceresolvers.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.8.0
  creationTimestamp: null
  name: serviceresolvers.consul.hashicorp.com
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: crd
spec:
  group: consul.hashicorp.com
  names:
    kind: ServiceResolver
    listKind: ServiceResolverList
    plural: serviceresolvers
    shortNames:
    - service-resolver
    singular: serviceresolver
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The sync status of the resource with Consul
      jsonPath: .status.conditions[?(@.type=="Synced")].status
      name: Synced
      type: string
    - description: The last successful synced time of the resource with Consul
      jsonPath: .status.lastSyncedTime
      name: Last Synced
      type: date
    - description: The age of the resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ServiceResolver is the Schema for the serviceresolvers API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: ServiceResolverSpec defines the desired state of ServiceResolver.
            properties:
              connectTimeout:
                description: ConnectTimeout is the timeout for establishing new network
                  connections to this service.
                type: string
              defaultSubset:
                description: DefaultSubset is the subset to use when no explicit subset
                  is requested. If empty the unnamed subset is used.
                type: string
              failover:
                additionalProperties:
                  properties:
                    datacenters:
                      description: Datacenters is a fixed list of datacenters to try
                        during failover.
                      items:
                        type: string
                      type: array
                    namespace:
                      description: Namespace is the namespace to resolve the requested
                        service from to form the failover group of instances. If empty
                        the current namespace is used.
                      type: string
                    service:
                      description: Service is the service to resolve instead of the
                        default as the failover group of instances during failover.
                      type: string
                    serviceSubset:
                      description: ServiceSubset is the named subset of the requested
                        service to resolve as the failover group of instances. If
                        empty the default subset for the requested service is used.
                      type: string
                    targets:
                      description: Targets specifies a fixed list of failover targets
                        to try during failover.
                      items:
                        properties:
                          datacenter:
                            description: Datacenter specifies the datacenter to try
                              during failover.
                            type: string
                          namespace:
                            description: Namespace specifies the namespace to try
                              during failover.
                            type: string
                          partition:
                            description: Partition specifies the partition to try
                              during failover.
                            type: string
                          peer:
                            description: Peer specifies the name of the cluster peer
                              to try during failover.
                            type: string
                          service:
                            description: Service specifies the name of the service
                              to try during failover.
                            type: string
                          serviceSubset:
                            description: ServiceSubset specifies the service subset
                              to try during failover.
                            type: string
                        type: object
                      type: array
                  type: object
                description: Failover controls when and how to reroute traffic to
                  an alternate pool of service instances. The map is keyed by the
                  service subset it applies to and the special string "*" is a wildcard
                  that applies to any subset not otherwise specified here.
                type: object
              loadBalancer:
                description: LoadBalancer determines the load balancing policy and
                  configuration for services issuing requests to this upstream service.
                properties:
                  hashPolicies:
                    description: HashPolicies is a list of hash policies to use for
                      hashing load balancing algorithms. Hash policies are evaluated
                      individually and combined such that identical lists result in
                      the same hash. If no hash policies are present, or none are
                      successfully evaluated, then a random backend host will be selected.
                    items:
                      properties:
                        cookieConfig:
                          description: CookieConfig contains configuration for the
                            "cookie" hash policy type.
                          properties:
                            path:
                              description: Path is the path to set for the cookie.
                              type: string
                            session:
                              description: Session determines whether to generate
                                a session cookie with no expiration.
                              type: boolean
                            ttl:
                              description: TTL is the ttl for generated cookies. Cannot
                                be specified for session cookies.
                              type: string
                          type: object
                        field:
                          description: Field is the attribute type to hash on. Must
                            be one of "header", "cookie", or "query_parameter". Cannot
                            be specified along with sourceIP.
                          type: string
                        fieldValue:
                          description: FieldValue is the value to hash. ie. header
                            name, cookie name, URL query parameter name Cannot be
                            specified along with sourceIP.
                          type: string
                        sourceIP:
                          description: SourceIP determines whether the hash should
                            be of the source IP rather than of a field and field value.
                            Cannot be specified along with field or fieldValue.
                          type: boolean
                        terminal:
                          description: Terminal will short circuit the computation
                            of the hash when multiple hash policies are present. If
                            a hash is computed when a Terminal policy is evaluated,
                            then that hash will be used and subsequent hash policies
                            will be ignored.
                          type: boolean
                      type: object
                    type: array
                  leastRequestConfig:
                    description: LeastRequestConfig contains configuration for the
                      "leastRequest" policy type.
                    properties:
                      choiceCount:
                        description: ChoiceCount determines the number of random healthy
                          hosts from which to select the one with the least requests.
                        format: int32
                        type: integer
                    type: object
                  policy:
                    description: Policy is the load balancing policy used to select
                      a host.
                    type: string
                  ringHashConfig:
                    description: RingHashConfig contains configuration for the "ringHash"
                      policy type.
                    properties:
                      maximumRingSize:
                        description: MaximumRingSize determines the maximum number
                          of entries in the hash ring.
                        format: int64
                        type: integer
                      minimumRingSize:
                        description: MinimumRingSize determines the minimum number
                          of entries in the hash ring.
                        format: int64
                        type: integer
                    type: object
                type: object
              redirect:
                description: Redirect when configured, all attempts to resolve the
                  service this resolver defines will be substituted for the supplied
                  redirect EXCEPT when the redirect has already been applied. When
                  substituting the supplied redirect, all other fields besides Kind,
                  Name, and Redirect will be ignored.
                properties:
                  datacenter:
                    description: Datacenter is the datacenter to resolve the service
                      from instead of the current one.
                    type: string
                  namespace:
                    description: Namespace is the Consul namespace to resolve the
                      service from instead of the current namespace. If empty the
                      current namespace is assumed.
                    type: string
                  partition:
                    description: Partition is the Consul partition to resolve the
                      service from instead of the current partition. If empty the
                      current partition is assumed.
                    type: string
                  peer:
                    description: Peer is the name of the cluster peer to resolve the
                      service from instead of the current one.
                    type: string
                  service:
                    description: Service is a service to resolve instead of the current
                      service.
                    type: string
                  serviceSubset:
                    description: ServiceSubset is a named subset of the given service
                      to resolve instead of one defined as that service's DefaultSubset
                      If empty the default subset is used.
                    type: string
                type: object
              subsets:
                additionalProperties:
                  properties:
                    filter:
                      description: Filter is the filter expression to be used for
                        selecting instances of the requested service. If empty all
                        healthy instances are returned. This expression can filter
                        on the same selectors as the Health API endpoint.
                      type: string
                    onlyPassing:
                      description: OnlyPassing specifies the behavior of the resolver's
                        health check interpretation. If this is set to false, instances
                        with checks in the passing as well as the warning states will
                        be considered healthy. If this is set to true, only instances
                        with checks in the passing state will be considered healthy.
                      type: boolean
                  type: object
                description: Subsets is map of subset name to subset definition for
                  all usable named subsets of this service. The map key is the name
                  of the subset and all names must be valid DNS subdomain elements.
                  This may be empty, in which case only the unnamed default subset
                  will be usable.
                type: object
            type: object
          status:
            properties:
              conditions:
                description: Conditions indicate the latest available observations
                  of a resource's current state.
                items:
                  description: 'Conditions define a readiness condition for a Consul
                    resource. See: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#typical-status-properties'
                  properties:
                    lastTransitionTime:
                      description: LastTransitionTime is the last time the condition
                        transitioned from one status to another.
                      format: date-time
                      type: string
                    message:
                      description: A human readable message indicating details about
                        the transition.
                      type: string
                    reason:
                      description: The reason for the condition's last transition.
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown.
                      type: string
                    type:
                      description: Type of condition.
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              lastSyncedTime:
                description: LastSyncedTime is the last time the resource successfully
                  synced with Consul.
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
# Source: consul/templates/crd-servicerouters.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.8.0
  creationTimestamp: null
  name: servicerouters.consul.hashicorp.com
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: crd
spec:
  group: consul.hashicorp.com
  names:
    kind: ServiceRouter
    listKind: ServiceRouterList
    plural: servicerouters
    shortNames:
    - service-router
    singular: servicerouter
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The sync status of the resource with Consul
      jsonPath: .status.conditions[?(@.type=="Synced")].status
      name: Synced
      type: string
    - description: The last successful synced time of the resource with Consul
      jsonPath: .status.lastSyncedTime
      name: Last Synced
      type: date
    - description: The age of the resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ServiceRouter is the Schema for the servicerouters API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: ServiceRouterSpec defines the desired state of ServiceRouter.
            properties:
              routes:
                description: Routes are the list of routes to consider when processing
                  L7 requests. The first route to match in the list is terminal and
                  stops further evaluation. Traffic that fails to match any of the
                  provided routes will be routed to the default service.
                items:
                  properties:
                    destination:
                      description: Destination controls how to proxy the matching
                        request(s) to a service.
                      properties:
                        namespace:
                          description: Namespace is the Consul namespace to resolve
                            the service from instead of the current namespace. If
                            empty the current namespace is assumed.
                          type: string
                        numRetries:
                          description: NumRetries is the number of times to retry
                            the request when a retryable result occurs
                          format: int32
                          type: integer
                        partition:
                          description: Partition is the Consul partition to resolve
                            the service from instead of the current partition. If
                            empty the current partition is assumed.
                          type: string
                        prefixRewrite:
                          description: PrefixRewrite defines how to rewrite the HTTP
                            request path before proxying it to its final destination.
                            This requires that either match.http.pathPrefix or match.http.pathExact
                            be configured on this route.
                          type: string
                        requestHeaders:
                          description: Allow HTTP header manipulation to be configured.
                          properties:
                            add:
                              additionalProperties:
                                type: string
                              description: Add is a set of name -> value pairs that
                                should be appended to the request or response (i.e.
                                allowing duplicates if the same header already exists).
                              type: object
                            remove:
                              description: Remove is the set of header names that
                                should be stripped from the request or response.
                              items:
                                type: string
                              type: array
                            set:
                              additionalProperties:
                                type: string
                              description: Set is a set of name -> value pairs that
                                should be added to the request or response, overwriting
                                any existing header values of the same name.
                              type: object
                          type: object
                        requestTimeout:
                          description: RequestTimeout is the total amount of time
                            permitted for the entire downstream request (and retries)
                            to be processed.
                          type: string
                        responseHeaders:
                          description: HTTPHeaderModifiers is a set of rules for HTTP
                            header modification that should be performed by proxies
                            as the request passes through them. It can operate on
                            either request or response headers depending on the context
                            in which it is used.
                          properties:
                            add:
                              additionalProperties:
                                type: string
                              description: Add is a set of name -> value pairs that
                                should be appended to the request or response (i.e.
                                allowing duplicates if the same header already exists).
                              type: object
                            remove:
                              description: Remove is the set of header names that
                                should be stripped from the request or response.
                              items:
                                type: string
                              type: array
                            set:
                              additionalProperties:
                                type: string
                              description: Set is a set of name -> value pairs that
                                should be added to the request or response, overwriting
                                any existing header values of the same name.
                              type: object
                          type: object
                        retryOnConnectFailure:
                          description: RetryOnConnectFailure allows for connection
                            failure errors to trigger a retry.
                          type: boolean
                        retryOnStatusCodes:
                          description: RetryOnStatusCodes is a flat list of http response
                            status codes that are eligible for retry.
                          items:
                            format: int32
                            type: integer
                          type: array
                        service:
                          description: Service is the service to resolve instead of
                            the default service. If empty then the default service
                            name is used.
                          type: string
                        serviceSubset:
                          description: ServiceSubset is a named subset of the given
                            service to resolve instead of the one defined as that
                            service's DefaultSubset. If empty, the default subset
                            is used.
                          type: string
                      type: object
                    match:
                      description: Match is a set of criteria that can match incoming
                        L7 requests. If empty or omitted it acts as a catch-all.
                      properties:
                        http:
                          description: HTTP is a set of http-specific match criteria.
                          properties:
                            header:
                              description: Header is a set of criteria that can match
                                on HTTP request headers. If more than one is configured
                                all must match for the overall match to apply.
                              items:
                                properties:
                                  exact:
                                    description: Exact will match if the header with
                                      the given name is this value.
                                    type: string
                                  invert:
                                    description: Invert inverts the logic of the match.
                                    type: boolean
                                  name:
                                    description: Name is the name of the header to
                                      match.
                                    type: string
                                  prefix:
                                    description: Prefix will match if the header with
                                      the given name has this prefix.
                                    type: string
                                  present:
                                    description: Present will match if the header
                                      with the given name is present with any value.
                                    type: boolean
                                  regex:
                                    description: Regex will match if the header with
                                      the given name matches this pattern.
                                    type: string
                                  suffix:
                                    description: Suffix will match if the header with
                                      the given name has this suffix.
                                    type: string
                                required:
                                - name
                                type: object
                              type: array
                            methods:
                              description: Methods is a list of HTTP methods for which
                                this match applies. If unspecified all http methods
                                are matched.
                              items:
                                type: string
                              type: array
                            pathExact:
                              description: PathExact is an exact path to match on
                                the HTTP request path.
                              type: string
                            pathPrefix:
                              description: PathPrefix is a path prefix to match on
                                the HTTP request path.
                              type: string
                            pathRegex:
                              description: PathRegex is a regular expression to match
                                on the HTTP request path.
                              type: string
                            queryParam:
                              description: QueryParam is a set of criteria that can
                                match on HTTP query parameters. If more than one is
                                configured all must match for the overall match to
                                apply.
                              items:
                                properties:
                                  exact:
                                    description: Exact will match if the query parameter
                                      with the given name is this value.
                                    type: string
                                  name:
                                    description: Name is the name of the query parameter
                                      to match on.
                                    type: string
                                  present:
                                    description: Present will match if the query parameter
                                      with the given name is present with any value.
                                    type: boolean
                                  regex:
                                    description: Regex will match if the query parameter
                                      with the given name matches this pattern.
                                    type: string
                                required:
                                - name
                                type: object
                              type: array
                          type: object
                      type: object
                  type: object
                type: array
            type: object
          status:
            properties:
              conditions:
                description: Conditions indicate the latest available observations
                  of a resource's current state.
                items:
                  description: 'Conditions define a readiness condition for a Consul
                    resource. See: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#typical-status-properties'
                  properties:
                    lastTransitionTime:
                      description: LastTransitionTime is the last time the condition
                        transitioned from one status to another.
                      format: date-time
                      type: string
                    message:
                      description: A human readable message indicating details about
                        the transition.
                      type: string
                    reason:
                      description: The reason for the condition's last transition.
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown.
                      type: string
                    type:
                      description: Type of condition.
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              lastSyncedTime:
                description: LastSyncedTime is the last time the resource successfully
                  synced with Consul.
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
# Source: consul/templates/crd-servicesplitters.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.8.0
  creationTimestamp: null
  name: servicesplitters.consul.hashicorp.com
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: crd
spec:
  group: consul.hashicorp.com
  names:
    kind: ServiceSplitter
    listKind: ServiceSplitterList
    plural: servicesplitters
    shortNames:
    - service-splitter
    singular: servicesplitter
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The sync status of the resource with Consul
      jsonPath: .status.conditions[?(@.type=="Synced")].status
      name: Synced
      type: string
    - description: The last successful synced time of the resource with Consul
      jsonPath: .status.lastSyncedTime
      name: Last Synced
      type: date
    - description: The age of the resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ServiceSplitter is the Schema for the servicesplitters API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: ServiceSplitterSpec defines the desired state of ServiceSplitter.
            properties:
              splits:
                description: Splits defines how much traffic to send to which set
                  of service instances during a traffic split. The sum of weights
                  across all splits must add up to 100.
                items:
                  properties:
                    namespace:
                      description: Namespace is the Consul namespace to resolve the
                        service from instead of the current namespace. If empty the
                        current namespace is assumed.
                      type: string
                    partition:
                      description: Partition is the Consul partition to resolve the
                        service from instead of the current partition. If empty the
                        current partition is assumed.
                      type: string
                    requestHeaders:
                      description: Allow HTTP header manipulation to be configured.
                      properties:
                        add:
                          additionalProperties:
                            type: string
                          description: Add is a set of name -> value pairs that should
                            be appended to the request or response (i.e. allowing
                            duplicates if the same header already exists).
                          type: object
                        remove:
                          description: Remove is the set of header names that should
                            be stripped from the request or response.
                          items:
                            type: string
                          type: array
                        set:
                          additionalProperties:
                            type: string
                          description: Set is a set of name -> value pairs that should
                            be added to the request or response, overwriting any existing
                            header values of the same name.
                          type: object
                      type: object
                    responseHeaders:
                      description: HTTPHeaderModifiers is a set of rules for HTTP
                        header modification that should be performed by proxies as
                        the request passes through them. It can operate on either
                        request or response headers depending on the context in which
                        it is used.
                      properties:
                        add:
                          additionalProperties:
                            type: string
                          description: Add is a set of name -> value pairs that should
                            be appended to the request or response (i.e. allowing
                            duplicates if the same header already exists).
                          type: object
                        remove:
                          description: Remove is the set of header names that should
                            be stripped from the request or response.
                          items:
                            type: string
                          type: array
                        set:
                          additionalProperties:
                            type: string
                          description: Set is a set of name -> value pairs that should
                            be added to the request or response, overwriting any existing
                            header values of the same name.
                          type: object
                      type: object
                    service:
                      description: Service is the service to resolve instead of the
                        default.
                      type: string
                    serviceSubset:
                      description: ServiceSubset is a named subset of the given service
                        to resolve instead of one defined as that service's DefaultSubset.
                        If empty the default subset is used.
                      type: string
                    weight:
                      description: Weight is a value between 0 and 100 reflecting
                        what portion of traffic should be directed to this split.
                        The smallest representable weight is 1/10000 or .01%.
                      type: number
                  type: object
                type: array
            type: object
          status:
            properties:
              conditions:
                description: Conditions indicate the latest available observations
                  of a resource's current state.
                items:
                  description: 'Conditions define a readiness condition for a Consul
                    resource. See: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#typical-status-properties'
                  properties:
                    lastTransitionTime:
                      description: LastTransitionTime is the last time the condition
                        transitioned from one status to another.
                      format: date-time
                      type: string
                    message:
                      description: A human readable message indicating details about
                        the transition.
                      type: string
                    reason:
                      description: The reason for the condition's last transition.
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown.
                      type: string
                    type:
                      description: Type of condition.
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              lastSyncedTime:
                description: LastSyncedTime is the last time the resource successfully
                  synced with Consul.
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
# Source: consul/templates/crd-terminatinggateways.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.8.0
  creationTimestamp: null
  name: terminatinggateways.consul.hashicorp.com
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: crd
spec:
  group: consul.hashicorp.com
  names:
    kind: TerminatingGateway
    listKind: TerminatingGatewayList
    plural: terminatinggateways
    shortNames:
    - terminating-gateway
    singular: terminatinggateway
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The sync status of the resource with Consul
      jsonPath: .status.conditions[?(@.type=="Synced")].status
      name: Synced
      type: string
    - description: The last successful synced time of the resource with Consul
      jsonPath: .status.lastSyncedTime
      name: Last Synced
      type: date
    - description: The age of the resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: TerminatingGateway is the Schema for the terminatinggateways
          API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: TerminatingGatewaySpec defines the desired state of TerminatingGateway.
            properties:
              services:
                description: Services is a list of service names represented by the
                  terminating gateway.
                items:
                  description: A LinkedService is a service represented by a terminating
                    gateway.
                  properties:
                    caFile:
                      description: CAFile is the optional path to a CA certificate
                        to use for TLS connections from the gateway to the linked
                        service.
                      type: string
                    certFile:
                      description: CertFile is the optional path to a client certificate
                        to use for TLS connections from the gateway to the linked
                        service.
                      type: string
                    keyFile:
                      description: KeyFile is the optional path to a private key to
                        use for TLS connections from the gateway to the linked service.
                      type: string
                    name:
                      description: Name is the name of the service, as defined in
                        Consul's catalog.
                      type: string
                    namespace:
                      description: The namespace the service is registered in.
                      type: string
                    sni:
                      description: SNI is the optional name to specify during the
                        TLS handshake with a linked service.
                      type: string
                  type: object
                type: array
            type: object
          status:
            properties:
              conditions:
                description: Conditions indicate the latest available observations
                  of a resource's current state.
                items:
                  description: 'Conditions define a readiness condition for a Consul
                    resource. See: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#typical-status-properties'
                  properties:
                    lastTransitionTime:
                      description: LastTransitionTime is the last time the condition
                        transitioned from one status to another.
                      format: date-time
                      type: string
                    message:
                      description: A human readable message indicating details about
                        the transition.
                      type: string
                    reason:
                      description: The reason for the condition's last transition.
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown.
                      type: string
                    type:
                      description: Type of condition.
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              lastSyncedTime:
                description: LastSyncedTime is the last time the resource successfully
                  synced with Consul.
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
# Source: consul/templates/auth-method-clusterrole.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: consul-auth-method
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: auth-method
rules:
- apiGroups: [ "" ]
  resources:
  - serviceaccounts
  verbs:
  - get
---
# Source: consul/templates/connect-inject-clusterrole.yaml
# The ClusterRole to enable the Connect injector to get, list, watch and patch MutatingWebhookConfiguration.
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: consul-connect-injector
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: connect-injector
rules:
- apiGroups:
  - consul.hashicorp.com
  resources:
  - servicedefaults
  - serviceresolvers
  - proxydefaults
  - meshes
  - exportedservices
  - servicerouters
  - servicesplitters
  - serviceintentions
  - ingressgateways
  - terminatinggateways
  - peeringacceptors
  - peeringdialers
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - consul.hashicorp.com
  resources:
  - servicedefaults/status
  - serviceresolvers/status
  - proxydefaults/status
  - meshes/status
  - exportedservices/status
  - servicerouters/status
  - servicesplitters/status
  - serviceintentions/status
  - ingressgateways/status
  - terminatinggateways/status
  - peeringacceptors/status
  - peeringdialers/status
  verbs:
  - get
  - patch
  - update
- apiGroups: [ "" ]
  resources: [ "serviceaccounts", "secrets" ]
  verbs:
  - get
- apiGroups: [ "" ]
  resources: [ "endpoints", "services", "namespaces", "nodes" ]
  verbs:
  - "get"
  - "list"
  - "watch"
- apiGroups: [ "" ]
  resources:
  - pods
  verbs:
  - "get"
  - "list"
  - "watch"
  - "update"
- apiGroups:
  - coordination.k8s.io
  resources:
  - leases
  verbs:
  - create
  - get
  - list
  - update
- apiGroups: [ "" ]
  resources: [ "secrets" ]
  verbs:
  - "get"
  - "list"
  - "watch"
  - "create"
  - "update"
  - "delete"
---
# Source: consul/templates/mesh-gateway-clusterrole.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: consul-mesh-gateway
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: mesh-gateway
rules:
  - apiGroups: [""]
    resources:
      - services
    resourceNames:
      - consul-mesh-gateway
    verbs:
      - get
---
# Source: consul/templates/webhook-cert-manager-clusterrole.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: consul-webhook-cert-manager
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: webhook-cert-manager
rules:
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - mutatingwebhookconfigurations
  verbs:
  - get
  - list
  - watch
  - patch
- apiGroups:
  - apps
  resources:
  - deployments
  resourceNames:
  - consul-webhook-cert-manager
  verbs:
  - get
---
# Source: consul/templates/auth-method-clusterrolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: consul-authdelegator
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: auth-method
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: "system:auth-delegator"
subjects:
- kind: ServiceAccount
  name: consul-auth-method
  namespace: consul
---
# Source: consul/templates/auth-method-clusterrolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: consul-auth-method
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: auth-method
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: consul-auth-method
subjects:
- kind: ServiceAccount
  name: consul-auth-method
  namespace: consul
---
# Source: consul/templates/connect-inject-clusterrolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: consul-connect-injector
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: connect-injector
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: consul-connect-injector
subjects:
- kind: ServiceAccount
  name: consul-connect-injector
  namespace: consul
---
# Source: consul/templates/mesh-gateway-clusterrolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: consul-mesh-gateway
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: mesh-gateway
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: consul-mesh-gateway
subjects:
  - kind: ServiceAccount
    name: consul-mesh-gateway
    namespace: consul
---
# Source: consul/templates/webhook-cert-manager-clusterrolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: consul-webhook-cert-manager
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: webhook-cert-manager
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: consul-webhook-cert-manager
subjects:
- kind: ServiceAccount
  name: consul-webhook-cert-manager
  namespace: consul
---
# Source: consul/templates/connect-inject-leader-election-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: consul-connect-inject-leader-election
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: connect-injector
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - ""
  resources:
  - configmaps/status
  verbs:
  - get
  - update
  - patch
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
  - patch
---
# Source: consul/templates/ingress-gateways-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: consul-ingress-gateway
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: ingress-gateway
    ingress-gateway-name: consul-ingress-gateway
rules:
  - apiGroups: [""]
    resources:
      - services
    resourceNames:
      - consul-ingress-gateway
    verbs:
      - get
  - apiGroups: [""]
    resources:
      - secrets
    resourceNames:
      - consul-ingress-gateway-acl-token
    verbs:
      - get
---
# Source: consul/templates/server-acl-init-cleanup-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: consul-server-acl-init-cleanup
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: server-acl-init-cleanup
rules:
  - apiGroups: ["batch"]
    resources: ["jobs"]
    verbs: ["get", "delete"]
---
# Source: consul/templates/server-acl-init-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: consul-server-acl-init
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: server-acl-init
rules:
- apiGroups: [ "" ]
  resources:
  - secrets
  verbs:
  - create
  - get
- apiGroups: [ "" ]
  resources:
  - serviceaccounts
  resourceNames:
  - consul-auth-method
  verbs:
  - get
---
# Source: consul/templates/server-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: consul-server
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: server
rules: []
---
# Source: consul/templates/connect-inject-leader-election-rolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: consul-connect-inject-leader-election
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: connect-injector
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: consul-connect-inject-leader-election
subjects:
- kind: ServiceAccount
  name: consul-connect-injector
  namespace: consul
---
# Source: consul/templates/ingress-gateways-rolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: consul-ingress-gateway
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: ingress-gateway
    ingress-gateway-name: consul-ingress-gateway
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: consul-ingress-gateway
subjects:
  - kind: ServiceAccount
    name: consul-ingress-gateway
---
# Source: consul/templates/server-acl-init-cleanup-rolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: consul-server-acl-init-cleanup
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: server-acl-init-cleanup
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: consul-server-acl-init-cleanup
subjects:
  - kind: ServiceAccount
    name: consul-server-acl-init-cleanup
---
# Source: consul/templates/server-acl-init-rolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: consul-server-acl-init
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: server-acl-init
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: consul-server-acl-init
subjects:
  - kind: ServiceAccount
    name: consul-server-acl-init
---
# Source: consul/templates/server-rolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: consul-server
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: server
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: consul-server
subjects:
  - kind: ServiceAccount
    name: consul-server
---
# Source: consul/templates/connect-inject-service.yaml
# The service for the Connect sidecar injector
apiVersion: v1
kind: Service
metadata:
  name: consul-connect-injector
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: connect-injector
spec:
  ports:
  - port: 443
    targetPort: 8080
  selector:
    app: consul
    release: "consul1-westus2"
    component: connect-injector
---
# Source: consul/templates/ingress-gateways-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: consul-ingress-gateway
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: ingress-gateway
    ingress-gateway-name: consul-ingress-gateway
spec:
  selector:
    app: consul
    release: "consul1-westus2"
    component: ingress-gateway
    ingress-gateway-name: consul-ingress-gateway
  ports:
    - name: gateway-0
      port: 8080
    - name: gateway-1
      port: 8443
  type: LoadBalancer
---
# Source: consul/templates/mesh-gateway-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: consul-mesh-gateway
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: mesh-gateway
  annotations:
    service.beta.kubernetes.io/azure-load-balancer-internal: "true"
spec:
  selector:
    app: consul
    release: "consul1-westus2"
    component: mesh-gateway
  ports:
    - name: gateway
      port: 443
      targetPort: 8443
  type: LoadBalancer
---
# Source: consul/templates/server-service.yaml
# Headless service for Consul server DNS entries. This service should only
# point to Consul servers. For access to an agent, one should assume that
# the agent is installed locally on the node and the NODE_IP should be used.
# If the node can't run a Consul agent, then this service can be used to
# communicate directly to a server agent.
apiVersion: v1
kind: Service
metadata:
  name: consul-server
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: server
  annotations:
spec:
  clusterIP: None
  # We want the servers to become available even if they're not ready
  # since this DNS is also used for join operations.
  publishNotReadyAddresses: true
  ports:
    - name: https
      port: 8501
      targetPort: 8501
    - name: grpc
      port: 8502
      targetPort: 8502
    - name: serflan-tcp
      protocol: "TCP"
      port: 8301
      targetPort: 8301
    - name: serflan-udp
      protocol: "UDP"
      port: 8301
      targetPort: 8301
    - name: serfwan-tcp
      protocol: "TCP"
      port: 8302
      targetPort: 8302
    - name: serfwan-udp
      protocol: "UDP"
      port: 8302
      targetPort: 8302
    - name: server
      port: 8300
      targetPort: 8300
    - name: dns-tcp
      protocol: "TCP"
      port: 8600
      targetPort: dns-tcp
    - name: dns-udp
      protocol: "UDP"
      port: 8600
      targetPort: dns-udp
  selector:
    app: consul
    release: "consul1-westus2"
    component: server
---
# Source: consul/templates/ui-service.yaml
# UI Service for Consul Server
apiVersion: v1
kind: Service
metadata:
  name: consul-ui
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: ui
spec:
  selector:
    app: consul
    release: "consul1-westus2"
    component: server
  ports:
    - name: https
      port: 443
      targetPort: 8501
  type: LoadBalancer
---
# Source: consul/templates/connect-inject-deployment.yaml
# The deployment for running the Connect sidecar injector
apiVersion: apps/v1
kind: Deployment
metadata:
  name: consul-connect-injector
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: connect-injector
spec:
  replicas: 1
  selector:
    matchLabels:
      app: consul
      chart: consul-helm
      release: consul1-westus2
      component: connect-injector
  template:
    metadata:
      labels:
        app: consul
        chart: consul-helm
        release: consul1-westus2
        component: connect-injector
      annotations:
        "consul.hashicorp.com/connect-inject": "false"
    spec:
      serviceAccountName: consul-connect-injector
      containers:
        - name: sidecar-injector
          image: "docker.mirror.hashicorp.services/hashicorp/consul-k8s-control-plane:1.0.2"
          ports:
            - containerPort: 8080
              name: webhook-server
              protocol: TCP
          env:
            - name: NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: CONSUL_ADDRESSES
              value: consul-server.consul.svc
            - name: CONSUL_GRPC_PORT
              value: "8502"
            - name: CONSUL_HTTP_PORT
              value: "8501"
            - name: CONSUL_DATACENTER
              value: consul1-westus2
            - name: CONSUL_API_TIMEOUT
              value: 5s
            - name: CONSUL_USE_TLS
              value: "true"
            - name: CONSUL_CACERT_FILE
              value: "/consul/tls/ca/tls.crt"
            - name: CONSUL_LOGIN_AUTH_METHOD
              value: consul-k8s-component-auth-method-consul1-westus2
            - name: CONSUL_LOGIN_DATACENTER
              value: consul0-eastus
            - name: CONSUL_LOGIN_META
              value: "component=connect-injector,pod=$(NAMESPACE)/$(POD_NAME)"
          command:
            - "/bin/sh"
            - "-ec"
            - |
              consul-k8s-control-plane inject-connect \
                -enable-federation \
                -log-level=info \
                -log-json=false \
                -default-inject=false \
                -consul-image="hashicorp/consul-enterprise:1.14.3-ent" \
                -consul-dataplane-image="hashicorp/consul-dataplane:1.0.0" \
                -consul-k8s-image="docker.mirror.hashicorp.services/hashicorp/consul-k8s-control-plane:1.0.2" \
                -release-name="consul1-westus2" \
                -release-namespace="consul" \
                -resource-prefix=consul \
                -listen=:8080 \
                -default-enable-transparent-proxy=false \
                -enable-cni=false \
                -enable-peering=true \
                -transparent-proxy-default-overwrite-probes=true \
                -default-enable-metrics=false \
                -enable-gateway-metrics=true  \
                -default-enable-metrics-merging=false  \
                -default-merged-metrics-port=20100 \
                -default-prometheus-scrape-port=20200 \
                -default-prometheus-scrape-path="/metrics" \
                -acl-auth-method="consul-k8s-auth-method" \
                -allow-k8s-namespace="*" \
                -enable-namespaces=true \
                -consul-destination-namespace=default \
                -enable-k8s-namespace-mirroring=true \
                -consul-cross-namespace-acl-policy=cross-namespace-policy \
                -tls-cert-dir=/etc/connect-injector/certs \
                -default-envoy-proxy-concurrency=2 \
                -init-container-memory-limit=150Mi \
                -init-container-memory-request=25Mi \
                -init-container-cpu-limit=50m \
                -init-container-cpu-request=50m \
          startupProbe:
            httpGet:
              path: /readyz/ready
              port: 9445
              scheme: HTTP
            initialDelaySeconds: 30
            failureThreshold: 15
            periodSeconds: 2
            timeoutSeconds: 5
          livenessProbe:
            httpGet:
              path: /readyz/ready
              port: 9445
              scheme: HTTP
            failureThreshold: 2
            initialDelaySeconds: 1
            successThreshold: 1
            timeoutSeconds: 5
          readinessProbe:
            httpGet:
              path: /readyz/ready
              port: 9445
              scheme: HTTP
            failureThreshold: 2
            initialDelaySeconds: 2
            successThreshold: 1
            timeoutSeconds: 5
          volumeMounts:
            - name: certs
              mountPath: /etc/connect-injector/certs
              readOnly: true
            - name: consul-ca-cert
              mountPath: /consul/tls/ca
              readOnly: true
          resources:
            limits:
              cpu: 50m
              memory: 50Mi
            requests:
              cpu: 50m
              memory: 50Mi
      volumes:
        - name: certs
          secret:
            defaultMode: 420
            secretName: consul-connect-inject-webhook-cert
        - name: consul-ca-cert
          secret:
              secretName: consul-federation
              items:
                - key: caCert
                  path: tls.crt
---
# Source: consul/templates/ingress-gateways-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: consul-ingress-gateway
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: ingress-gateway
    ingress-gateway-name: consul-ingress-gateway
spec:
  replicas: 1
  selector:
    matchLabels:
      app: consul
      chart: consul-helm
      heritage: Helm
      release: consul1-westus2
      component: ingress-gateway
      ingress-gateway-name: consul-ingress-gateway
  template:
    metadata:
      labels:
        app: consul
        chart: consul-helm
        heritage: Helm
        release: consul1-westus2
        component: ingress-gateway
        ingress-gateway-name: consul-ingress-gateway
        consul.hashicorp.com/connect-inject-managed-by: consul-k8s-endpoints-controller
      annotations:
        "consul.hashicorp.com/connect-inject": "false"
        "consul.hashicorp.com/gateway-kind": "ingress-gateway"
        "consul.hashicorp.com/gateway-consul-service-name": "ingress-gateway"
        "consul.hashicorp.com/gateway-namespace": default
        "consul.hashicorp.com/gateway-wan-address-source": "Service"
        "consul.hashicorp.com/gateway-wan-port": "8080"
    spec:
      terminationGracePeriodSeconds: 10
      serviceAccountName: consul-ingress-gateway
      volumes:
      - name: consul-service
        emptyDir:
          medium: "Memory"
      - name: consul-ca-cert
        secret:
          secretName: consul-federation
          items:
          - key: caCert
            path: tls.crt
      initContainers:
      # ingress-gateway-init registers the ingress gateway service with Consul.
      - name: ingress-gateway-init
        image: docker.mirror.hashicorp.services/hashicorp/consul-k8s-control-plane:1.0.2
        env:
        - name: NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: CONSUL_ADDRESSES
          value: consul-server.consul.svc
        - name: CONSUL_GRPC_PORT
          value: "8502"
        - name: CONSUL_HTTP_PORT
          value: "8501"
        - name: CONSUL_DATACENTER
          value: consul1-westus2
        - name: CONSUL_API_TIMEOUT
          value: 5s
        - name: CONSUL_USE_TLS
          value: "true"
        - name: CONSUL_CACERT_FILE
          value: "/consul/tls/ca/tls.crt"
        - name: CONSUL_NAMESPACE
          value: default
        - name: CONSUL_LOGIN_AUTH_METHOD
          value: consul-k8s-component-auth-method
        - name: CONSUL_LOGIN_DATACENTER
          value: consul1-westus2
        - name: CONSUL_LOGIN_META
          value: "component=ingress-gateway,pod=$(NAMESPACE)/$(POD_NAME)"
        - name: CONSUL_NODE_NAME
          value: $(NODE_NAME)-virtual
        command:
        - "/bin/sh"
        - "-ec"
        - |
          consul-k8s-control-plane connect-init -pod-name=${POD_NAME} -pod-namespace=${NAMESPACE} \
          -gateway-kind="ingress-gateway" \
          -proxy-id-file=/consul/service/proxy-id \
          -service-name=consul-ingress-gateway \
          -log-level=info \
          -log-json=false
        volumeMounts:
        - name: consul-service
          mountPath: /consul/service
        - name: consul-ca-cert
          mountPath: /consul/tls/ca
          readOnly: true
        resources:
          requests:
            memory: "50Mi"
            cpu: "50m"
          limits:
            memory: "50Mi"
            cpu: "50m"
      containers:
      - name: ingress-gateway
        image: "hashicorp/consul-dataplane:1.0.0"
        resources: 
          limits:
            cpu: 100m
            memory: 100Mi
          requests:
            cpu: 100m
            memory: 100Mi
        volumeMounts:
        - name: consul-service
          mountPath: /consul/service
          readOnly: true
        - name: consul-ca-cert
          mountPath: /consul/tls/ca
          readOnly: true
        env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: DP_ENVOY_READY_BIND_ADDRESS
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: DP_CREDENTIAL_LOGIN_META1
          value: pod=$(NAMESPACE)/$(POD_NAME)
        - name: DP_CREDENTIAL_LOGIN_META2
          value: component=ingress-gateway
        - name: DP_SERVICE_NODE_NAME
          value: $(NODE_NAME)-virtual
        command:
        - consul-dataplane
        args:
        - -envoy-ready-bind-port=21000
        - -addresses=consul-server.consul.svc
        - -grpc-port=8502
        - -proxy-service-id-path=/consul/service/proxy-id
        - -service-namespace=default
        - -ca-certs=/consul/tls/ca/tls.crt
        - -credential-type=login
        - -login-bearer-token-path=/var/run/secrets/kubernetes.io/serviceaccount/token
        - -login-auth-method=consul-k8s-component-auth-method
        - -log-level=info
        - -log-json=false
        livenessProbe:
          tcpSocket:
            port: 21000
          failureThreshold: 3
          initialDelaySeconds: 30
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        readinessProbe:
          tcpSocket:
            port: 21000
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        ports:
        - name: gateway-health
          containerPort: 21000
        - name: gateway-0
          containerPort: 8080
        - name: gateway-1
          containerPort: 8443
---
# Source: consul/templates/mesh-gateway-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: consul-mesh-gateway
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: mesh-gateway
spec:
  replicas: 3
  selector:
    matchLabels:
      app: consul
      chart: consul-helm
      release: consul1-westus2
      component: mesh-gateway
  template:
    metadata:
      labels:
        app: consul
        chart: consul-helm
        release: consul1-westus2
        component: mesh-gateway
        consul.hashicorp.com/connect-inject-managed-by: consul-k8s-endpoints-controller
      annotations:
        "consul.hashicorp.com/connect-inject": "false"
        "consul.hashicorp.com/gateway-kind": "mesh-gateway"
        "consul.hashicorp.com/gateway-consul-service-name": "mesh-gateway"
        "consul.hashicorp.com/mesh-gateway-container-port": "8443"
        "consul.hashicorp.com/gateway-wan-address-source": "Service"
        "consul.hashicorp.com/gateway-wan-address-static": ""
        "consul.hashicorp.com/gateway-wan-port": "443"
    spec:
      terminationGracePeriodSeconds: 10
      serviceAccountName: consul-mesh-gateway
      volumes:
      - name: consul-service
        emptyDir:
          medium: "Memory"
      - name: consul-ca-cert
        secret:
          secretName: consul-federation
          items:
          - key: caCert
            path: tls.crt
      initContainers:
      - name: mesh-gateway-init
        image: docker.mirror.hashicorp.services/hashicorp/consul-k8s-control-plane:1.0.2
        env:
        - name: NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: CONSUL_ADDRESSES
          value: consul-server.consul.svc
        - name: CONSUL_GRPC_PORT
          value: "8502"
        - name: CONSUL_HTTP_PORT
          value: "8501"
        - name: CONSUL_DATACENTER
          value: consul1-westus2
        - name: CONSUL_API_TIMEOUT
          value: 5s
        - name: CONSUL_USE_TLS
          value: "true"
        - name: CONSUL_CACERT_FILE
          value: "/consul/tls/ca/tls.crt"
        - name: CONSUL_LOGIN_AUTH_METHOD
          value: consul-k8s-component-auth-method-consul1-westus2
        - name: CONSUL_LOGIN_DATACENTER
          value: consul0-eastus
        - name: CONSUL_LOGIN_META
          value: "component=mesh-gateway,pod=$(NAMESPACE)/$(POD_NAME)"
        - name: CONSUL_NODE_NAME
          value: $(NODE_NAME)-virtual
        command:
        - "/bin/sh"
        - "-ec"
        - |
          consul-k8s-control-plane connect-init -pod-name=${POD_NAME} -pod-namespace=${NAMESPACE} \
           -gateway-kind="mesh-gateway" \
           -proxy-id-file=/consul/service/proxy-id \
           -service-name=mesh-gateway \
           -log-level=info \
           -log-json=false
        volumeMounts:
        - name: consul-service
          mountPath: /consul/service
        - name: consul-ca-cert
          mountPath: /consul/tls/ca
          readOnly: true
        resources: 
          limits:
            cpu: 50m
            memory: 50Mi
          requests:
            cpu: 50m
            memory: 50Mi
      containers:
      - name: mesh-gateway
        image: "hashicorp/consul-dataplane:1.0.0"
        resources:
            limits:
              cpu: 100m
              memory: 100Mi
            requests:
              cpu: 100m
              memory: 100Mi
        volumeMounts:
        - mountPath: /consul/service
          name: consul-service
          readOnly: true
        - name: consul-ca-cert
          mountPath: /consul/tls/ca
          readOnly: true
        env:
        - name: NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: DP_CREDENTIAL_LOGIN_META1
          value: pod=$(NAMESPACE)/$(POD_NAME)
        - name: DP_CREDENTIAL_LOGIN_META2
          value: component=mesh-gateway
        - name: DP_SERVICE_NODE_NAME
          value: $(NODE_NAME)-virtual
        command:
        - consul-dataplane
        args:
        - -addresses=consul-server.consul.svc
        - -grpc-port=8502
        - -proxy-service-id-path=/consul/service/proxy-id
        - -ca-certs=/consul/tls/ca/tls.crt
        - -credential-type=login
        - -login-bearer-token-path=/var/run/secrets/kubernetes.io/serviceaccount/token
        - -login-auth-method=consul-k8s-component-auth-method-consul1-westus2
        - -login-datacenter=consul0-eastus
        - -log-level=info
        - -log-json=false
        livenessProbe:
          tcpSocket:
            port: 8443
          failureThreshold: 3
          initialDelaySeconds: 30
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        readinessProbe:
          tcpSocket:
            port: 8443
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        ports:
        - name: gateway
          containerPort: 8443
---
# Source: consul/templates/webhook-cert-manager-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: consul-webhook-cert-manager
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: webhook-cert-manager
spec:
  replicas: 1
  selector:
    matchLabels:
      app: consul
      chart: consul-helm
      heritage: Helm
      release: consul1-westus2
      component: webhook-cert-manager
  template:
    metadata:
      labels:
        app: consul
        chart: consul-helm
        heritage: Helm
        release: consul1-westus2
        component: webhook-cert-manager
      annotations:
        "consul.hashicorp.com/connect-inject": "false"
        "consul.hashicorp.com/config-checksum": e988716017fe41d956f8563183290ae7ed20b9e0a7b25540f9e96660bf09f744
    spec:
      containers:
      - command:
        - "/bin/sh"
        - "-ec"
        - |
          consul-k8s-control-plane webhook-cert-manager \
            -log-level=info \
            -log-json=false \
            -config-file=/bootstrap/config/webhook-config.json \
            -deployment-name=consul-webhook-cert-manager \
            -deployment-namespace=consul
        image: docker.mirror.hashicorp.services/hashicorp/consul-k8s-control-plane:1.0.2
        name: webhook-cert-manager
        resources:
          limits:
            cpu: 100m
            memory: 50Mi
          requests:
            cpu: 100m
            memory: 50Mi
        volumeMounts:
        - name: config
          mountPath: /bootstrap/config
      terminationGracePeriodSeconds: 10
      serviceAccountName: consul-webhook-cert-manager
      volumes:
      - name: config
        configMap:
          name: consul-webhook-cert-manager-config
---
# Source: consul/templates/server-statefulset.yaml
# StatefulSet to run the actual Consul server cluster.
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: consul-server
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: server
spec:
  serviceName: consul-server
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app: consul
      chart: consul-helm
      release: consul1-westus2
      component: server
      hasDNS: "true"
  template:
    metadata:
      labels:
        app: consul
        chart: consul-helm
        release: consul1-westus2
        component: server
        hasDNS: "true"
      annotations:
        "consul.hashicorp.com/connect-inject": "false"
        "consul.hashicorp.com/config-checksum": 76d3c7603dc6349a695fe546075daf53a7da6b4fe75e52513dcab6a07b55d001
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchLabels:
                  app: consul
                  release: "consul1-westus2"
                  component: server
              topologyKey: kubernetes.io/hostname
      terminationGracePeriodSeconds: 30
      serviceAccountName: consul-server
      securityContext:
        fsGroup: 1000
        runAsGroup: 1000
        runAsNonRoot: true
        runAsUser: 100
      volumes:
        - name: config
          configMap:
            name: consul-server-config
        - name: extra-config
          emptyDir: {}
        - name: consul-ca-cert
          secret:
            secretName: consul-federation
            items:
            - key: caCert
              path: tls.crt
        - name: consul-server-cert
          secret:
            secretName: consul-server-cert
        - name: consul-license
          secret:
            secretName: consul-ent-license
        - name: userconfig-consul-federation
          secret:
            secretName: consul-federation
            items:
            - key: serverConfigJSON
              path: config.json
      containers:
        - name: consul
          image: "hashicorp/consul-enterprise:1.14.3-ent"
          env:
            - name: ADVERTISE_IP
              valueFrom:
                fieldRef:
                  fieldPath: status.podIP
            - name: HOST_IP
              valueFrom:
                fieldRef:
                  fieldPath: status.hostIP
            - name: POD_IP
              valueFrom:
                fieldRef:
                  fieldPath: status.podIP
            - name: CONSUL_DISABLE_PERM_MGMT
              value: "true"
            - name: GOSSIP_KEY
              valueFrom:
                secretKeyRef:
                  name: consul-federation
                  key: gossipEncryptionKey
            - name: CONSUL_HTTP_ADDR
              value: https://localhost:8501
            - name: CONSUL_CACERT
              value: /consul/tls/ca/tls.crt
            - name: CONSUL_LICENSE_PATH
              value: /consul/license/key
            - name: ACL_REPLICATION_TOKEN
              valueFrom:
                secretKeyRef:
                  name: "consul-federation"
                  key: "replicationToken"
            
          command:
            - "/bin/sh"
            - "-ec"
            - |

              cp /consul/config/extra-from-values.json /consul/extra-config/extra-from-values.json
              [ -n "${HOST_IP}" ] && sed -Ei "s|HOST_IP|${HOST_IP?}|g" /consul/extra-config/extra-from-values.json
              [ -n "${POD_IP}" ] && sed -Ei "s|POD_IP|${POD_IP?}|g" /consul/extra-config/extra-from-values.json
              [ -n "${HOSTNAME}" ] && sed -Ei "s|HOSTNAME|${HOSTNAME?}|g" /consul/extra-config/extra-from-values.json

              exec /usr/local/bin/docker-entrypoint.sh consul agent \
                -advertise="${ADVERTISE_IP}" \
                -config-dir=/consul/config \
                -encrypt="${GOSSIP_KEY}" \
                -hcl="acl { tokens { agent = \"${ACL_REPLICATION_TOKEN}\", replication = \"${ACL_REPLICATION_TOKEN}\" } }" \
                -config-dir=/consul/userconfig/consul-federation \
                -config-file=/consul/extra-config/extra-from-values.json
          volumeMounts:
            - name: data-consul
              mountPath: /consul/data
            - name: config
              mountPath: /consul/config
            - name: extra-config
              mountPath: /consul/extra-config
            - name: consul-ca-cert
              mountPath: /consul/tls/ca/
              readOnly: true
            - name: consul-server-cert
              mountPath: /consul/tls/server
              readOnly: true
            - name: consul-license
              mountPath: /consul/license
              readOnly: true
            - name: userconfig-consul-federation
              readOnly: true
              mountPath: /consul/userconfig/consul-federation
          ports:
            - name: https
              containerPort: 8501
            - name: grpc
              containerPort: 8502
              protocol: "TCP"
            - name: serflan-tcp
              containerPort: 8301
              protocol: "TCP"
            - name: serflan-udp
              containerPort: 8301
              protocol: "UDP"
            - name: serfwan-tcp
              containerPort: 8302
              protocol: "TCP"
            - name: serfwan-udp
              containerPort: 8302
              protocol: "UDP"
            - name: server
              containerPort: 8300
            - name: dns-tcp
              containerPort: 8600
              protocol: "TCP"
            - name: dns-udp
              containerPort: 8600
              protocol: "UDP"
          readinessProbe:
            # NOTE(mitchellh): when our HTTP status endpoints support the
            # proper status codes, we should switch to that. This is temporary.
            exec:
              command:
                - "/bin/sh"
                - "-ec"
                - |
                  curl -k \
                    https://127.0.0.1:8501/v1/status/leader \
                  2>/dev/null | grep -E '".+"'
            failureThreshold: 2
            initialDelaySeconds: 5
            periodSeconds: 3
            successThreshold: 1
            timeoutSeconds: 5
          resources:
            limits:
              cpu: 100m
              memory: 100Mi
            requests:
              cpu: 100m
              memory: 100Mi
          securityContext:
            null
  volumeClaimTemplates:
    - metadata:
        name: data-consul
      spec:
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 10Gi
---
# Source: consul/templates/server-acl-init-job.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: consul-server-acl-init
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: server-acl-init
spec:
  template:
    metadata:
      name: consul-server-acl-init
      labels:
        app: consul
        chart: consul-helm
        release: consul1-westus2
        component: server-acl-init
      annotations:
        "consul.hashicorp.com/connect-inject": "false"
    spec:
      restartPolicy: Never
      serviceAccountName: consul-server-acl-init
      volumes:
      - name: consul-ca-cert
        secret:
          secretName: consul-federation
          items:
          - key: caCert
            path: tls.crt
      - name: acl-replication-token
        secret:
          secretName: consul-federation
          items:
          - key: replicationToken
            path: acl-replication-token
      containers:
      - name: server-acl-init-job
        image: docker.mirror.hashicorp.services/hashicorp/consul-k8s-control-plane:1.0.2
        env:
        - name: NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: CONSUL_ADDRESSES
          value: consul-server.consul.svc
        - name: CONSUL_GRPC_PORT
          value: "8502"
        - name: CONSUL_HTTP_PORT
          value: "8501"
        - name: CONSUL_DATACENTER
          value: consul1-westus2
        - name: CONSUL_API_TIMEOUT
          value: 5s
        - name: CONSUL_USE_TLS
          value: "true"
        - name: CONSUL_CACERT_FILE
          value: "/consul/tls/ca/tls.crt"
        volumeMounts:
        - name: consul-ca-cert
          mountPath: /consul/tls/ca
          readOnly: true
        - name: acl-replication-token
          mountPath: /consul/acl/tokens
          readOnly: true
        command:
        - "/bin/sh"
        - "-ec"
        - |
          CONSUL_FULLNAME="consul"

          consul-k8s-control-plane server-acl-init \
            -log-level=info \
            -log-json=false \
            -resource-prefix=${CONSUL_FULLNAME} \
            -k8s-namespace=consul \
            -set-server-tokens=true \
            -enable-peering=true \
            -connect-inject=true \
            -auth-method-host=https://aks-6b7343b5.hcp.westus2.azmk8s.io:443 \
            -mesh-gateway=true \
            -ingress-gateway-name="ingress-gateway.default" \
            -acl-binding-rule-selector=serviceaccount.name!=default \
            -create-enterprise-license-token=true \
            -client=false \
            -federation=true \
            -acl-replication-token-file=/consul/acl/tokens/acl-replication-token \
            -enable-namespaces=true \
            -consul-inject-destination-namespace=default \
            -enable-inject-k8s-namespace-mirroring=true \
        resources:
          requests:
            memory: "50Mi"
            cpu: "50m"
          limits:
            memory: "50Mi"
            cpu: "50m"
---
# Source: consul/templates/connect-inject-mutatingwebhookconfiguration.yaml
# The MutatingWebhookConfiguration to enable the Connect injector.
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: consul-connect-injector
  namespace: consul
  labels:
    app: consul
    chart: consul-helm
    heritage: Helm
    release: consul1-westus2
    component: connect-injector
webhooks:
- clientConfig:
    service:
      name: consul-connect-injector
      namespace: consul
      path: /mutate-v1alpha1-proxydefaults
  failurePolicy: Fail
  admissionReviewVersions:
  - "v1beta1"
  - "v1"
  name: mutate-proxydefaults.consul.hashicorp.com
  rules:
  - apiGroups:
    - consul.hashicorp.com
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - proxydefaults
  sideEffects: None
- clientConfig:
    service:
      name: consul-connect-injector
      namespace: consul
      path: /mutate-v1alpha1-mesh
  failurePolicy: Fail
  admissionReviewVersions:
  - "v1beta1"
  - "v1"
  name: mutate-mesh.consul.hashicorp.com
  rules:
  - apiGroups:
    - consul.hashicorp.com
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - meshes
  sideEffects: None
- clientConfig:
    service:
      name: consul-connect-injector
      namespace: consul
      path: /mutate-v1alpha1-servicedefaults
  failurePolicy: Fail
  admissionReviewVersions:
  - "v1beta1"
  - "v1"
  name: mutate-servicedefaults.consul.hashicorp.com
  rules:
  - apiGroups:
    - consul.hashicorp.com
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - servicedefaults
  sideEffects: None
- clientConfig:
    service:
      name: consul-connect-injector
      namespace: consul
      path: /mutate-v1alpha1-serviceresolver
  failurePolicy: Fail
  admissionReviewVersions:
  - "v1beta1"
  - "v1"
  name: mutate-serviceresolver.consul.hashicorp.com
  rules:
  - apiGroups:
    - consul.hashicorp.com
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - serviceresolvers
  sideEffects: None
- clientConfig:
    service:
      name: consul-connect-injector
      namespace: consul
      path: /mutate-v1alpha1-servicerouter
  failurePolicy: Fail
  admissionReviewVersions:
  - "v1beta1"
  - "v1"
  name: mutate-servicerouter.consul.hashicorp.com
  rules:
  - apiGroups:
    - consul.hashicorp.com
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - servicerouters
  sideEffects: None
- clientConfig:
    service:
      name: consul-connect-injector
      namespace: consul
      path: /mutate-v1alpha1-servicesplitter
  failurePolicy: Fail
  admissionReviewVersions:
  - "v1beta1"
  - "v1"
  name: mutate-servicesplitter.consul.hashicorp.com
  rules:
  - apiGroups:
    - consul.hashicorp.com
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - servicesplitters
  sideEffects: None
- clientConfig:
    service:
      name: consul-connect-injector
      namespace: consul
      path: /mutate-v1alpha1-serviceintentions
  failurePolicy: Fail
  admissionReviewVersions:
  - "v1beta1"
  - "v1"
  name: mutate-serviceintentions.consul.hashicorp.com
  rules:
  - apiGroups:
    - consul.hashicorp.com
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - serviceintentions
  sideEffects: None
- clientConfig:
    service:
      name: consul-connect-injector
      namespace: consul
      path: /mutate-v1alpha1-ingressgateway
  failurePolicy: Fail
  admissionReviewVersions:
  - "v1beta1"
  - "v1"
  name: mutate-ingressgateway.consul.hashicorp.com
  rules:
  - apiGroups:
    - consul.hashicorp.com
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - ingressgateways
  sideEffects: None
- clientConfig:
    service:
      name: consul-connect-injector
      namespace: consul
      path: /mutate-v1alpha1-terminatinggateway
  failurePolicy: Fail
  admissionReviewVersions:
  - "v1beta1"
  - "v1"
  name: mutate-terminatinggateway.consul.hashicorp.com
  rules:
  - apiGroups:
    - consul.hashicorp.com
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - terminatinggateways
  sideEffects: None
- clientConfig:
    service:
      name: consul-connect-injector
      namespace: consul
      path: /mutate-v1alpha1-exportedservices
  failurePolicy: Fail
  admissionReviewVersions:
  - "v1beta1"
  - "v1"
  name: mutate-exportedservices.consul.hashicorp.com
  rules:
  - apiGroups:
    - consul.hashicorp.com
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - exportedservices
  sideEffects: None
- name: consul-connect-injector.consul.hashicorp.com
  # The webhook will fail scheduling all pods that are not part of consul if all replicas of the webhook are unhealthy.
  objectSelector:
    matchExpressions:
    - key: app
      operator: NotIn
      values: [ consul ]
  failurePolicy: Fail
  sideEffects: None
  admissionReviewVersions:
  - "v1beta1"
  - "v1"
  clientConfig:
    service:
      name: consul-connect-injector
      namespace: consul
      path: "/mutate"
  rules:
  - operations: [ "CREATE" ]
    apiGroups: [ "" ]
    apiVersions: [ "v1" ]
    resources: [ "pods" ]
  namespaceSelector:
      matchExpressions:
        - key: "kubernetes.io/metadata.name"
          operator: "NotIn"
          values: ["kube-system","local-path-storage"]
      
- name: consul-mutate-peeringacceptors.consul.hashicorp.com
  clientConfig:
    service:
      name: consul-connect-injector
      namespace: consul
      path: "/mutate-v1alpha1-peeringacceptors"
  rules:
  - apiGroups:
    - consul.hashicorp.com
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - peeringacceptors
  failurePolicy: Fail
  sideEffects: None
  admissionReviewVersions:
  - "v1beta1"
  - "v1"
- name: consul-mutate-peeringdialers.consul.hashicorp.com
  clientConfig:
    service:
      name: consul-connect-injector
      namespace: consul
      path: "/mutate-v1alpha1-peeringdialers"
  rules:
  - apiGroups:
    - consul.hashicorp.com
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - peeringdialers
  failurePolicy: Fail
  sideEffects: None
  admissionReviewVersions:
  - "v1beta1"
  - "v1"

NOTES:
Thank you for installing HashiCorp Consul!

Your release is named consul1-westus2.

To learn more about the release, run:

  $ helm status consul1-westus2 --namespace consul
  $ helm get all consul1-westus2 --namespace consul

Consul on Kubernetes Documentation:
https://www.consul.io/docs/platform/k8s

Consul on Kubernetes CLI Reference:
https://www.consul.io/docs/k8s/k8s-cli
Warning: Defining server extraConfig potentially disrupts the automatic ACL
         bootstrapping required settings. This may cause future issues if
         there are conflicts.
